/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See LICENSE.md for details.
 * v1.0.0-beta.517
 */
import{r as i,c as t,g as s,h as a,H as e,a as o}from"./p-8bbb13df.js";import{u as h,c as r,r as n,p as d,W as c,i as l,d as g,e as p,f as m,g as v,U as u,h as y,j as w,k as C,m as b}from"./p-75eb677e.js";import"@arcgis/core/request";import"@arcgis/core/rest/support/FeatureSet";import"@arcgis/core/layers/support/Field";import"@arcgis/core/layers/FeatureLayer";import"@arcgis/core/geometry/support/jsonUtils";import"@arcgis/core/renderers/support/jsonUtils";import"@arcgis/core/portal/Portal";import"@arcgis/core/core/promiseUtils";import"@arcgis/core/rest/support/Query";import"@arcgis/core/rest/support/StatisticDefinition";import"@arcgis/core/TimeExtent";import"@arcgis/core/symbols/support/symbolUtils";import"@arcgis/core/layers/support/FeatureFilter";import"@arcgis/core/smartMapping/statistics/histogram";import"@arcgis/core/Map";import"@arcgis/core/views/MapView";import"@arcgis/core/smartMapping/statistics/summaryStatistics";import"@arcgis/core/core/Collection";import{I as f,v as x,m as S,S as I,p as D,a as M}from"./p-15e79606.js";const L=class{constructor(s){i(this,s),this.arcgisChartsDataProcessError=t(this,"arcgisChartsDataProcessError",7),this.arcgisChartsDataProcessComplete=t(this,"arcgisChartsDataProcessComplete",7),this.arcgisChartsLegendItemVisibilityChange=t(this,"arcgisChartsLegendItemVisibilityChange",7),this.arcgisChartsUpdateComplete=t(this,"arcgisChartsUpdateComplete",7),this.arcgisChartsSeriesColorChange=t(this,"arcgisChartsSeriesColorChange",7),this.arcgisChartsAxesMinMaxChange=t(this,"arcgisChartsAxesMinMaxChange",7),this.arcgisChartsSelectionComplete=t(this,"arcgisChartsSelectionComplete",7),this.skipNextUpdate=!1,this.noRenderProps=["legendPosition","legendVisibility","view"],this.dataUpdateNeededProps=["forceDataUpdate","runtimeDataFilters","inlineData","returnFeaturesExtent"],this.updatedProps=new Set,this.config=void 0,this.inlineData=void 0,this.actionMode=void 0,this.legendPosition=void 0,this.legendVisibility=void 0,this.view=void 0,this.layer=void 0,this.selectionData=void 0,this.returnSelectionOIDs=void 0,this.returnSelectionIndexes=void 0,this.filterBySelection=void 0,this.noDataOptions=void 0,this.disableInteractions=void 0,this.queueChartCreation=void 0,this.useAnimatedCharts=void 0,this.hideLicenceWatermark=void 0,this.enableResponsiveFeatures=void 0,this.autoDisposeChart=void 0,this.placeholder=void 0,this.selectionTheme=void 0,this.tooltipFormatter=void 0,this.dataLabelFormatter=void 0,this.guideTooltipFormatter=void 0,this.xAxisLabelFormatter=void 0,this.yAxisLabelFormatter=void 0,this.disableTogglingLegendItems=void 0,this.hideLoaderAnimation=void 0,this.runtimeDataFilters=void 0,this.usePopupTemplateFieldsInfo=void 0,this.showNotifyPanel=!1}handleChartOutputDataChange(i){this.arcgisChartsDataProcessComplete.emit(i.detail)}handleLegendItemVisibilityChanged(i){this.arcgisChartsLegendItemVisibilityChange.emit(i.detail)}handleUpdateCompleted(i){this.arcgisChartsUpdateComplete.emit(i.detail)}handleSeriesColorsChange(i){this.arcgisChartsSeriesColorChange.emit(i.detail)}handleAxesMinMaxChange(i){this.arcgisChartsAxesMinMaxChange.emit(i.detail)}handleSelection(i){this.arcgisChartsSelectionComplete.emit(i.detail)}handleAlertClosed(i){i.target===this.el&&(this.skipNextUpdate=!0,this.showNotifyPanel=!1)}async viewChange(i,t){await this.addExtentChangeListener(),void 0!==t&&void 0===i&&await this.refresh()}async layerChange(){await this.addLayerListeners()}legendPositionChange(i){this.config=h(i,this.config)}legendVisibilityChange(i){this.config=r(i,this.config)}filterBySelectionChanged(){this.config=n(this.config)}async notify(i,t,s){return void 0!==this.chart&&this.chart.notify(i,t,s),Promise.resolve(void 0)}async errorAlert(i){this.notifyHeading=this.strings.errorHeading,this.notifyMessage=i,this.notifyOptions={kind:"danger",autoClose:!0,active:!0},this.showNotifyPanel=!0}async resetZoom(){return void 0!==this.chart&&this.chart.resetZoom(),Promise.resolve(void 0)}async switchSelection(){void 0!==this.chart&&!0!==this.filterBySelection&&await this.chart.switchSelection()}async clearSelection(){void 0!==this.chart&&(this.chart.clearSelection(),!0===this.filterBySelection&&await this.refresh())}async refresh(i){var t,s,a,e,o,h;const{updateData:r=!0,resetAxesBounds:n=!1,updateExtent:d=!1}=null!=i?i:{};this.viewExtentUpdated=d,!0===r&&this.dataUpdateIsNeeded(),!0===n&&(null===(a=null===(s=null===(t=this.config)||void 0===t?void 0:t.axes)||void 0===s?void 0:s[1])||void 0===a||delete a.minimum,null===(h=null===(o=null===(e=this.config)||void 0===e?void 0:e.axes)||void 0===o?void 0:o[1])||void 0===h||delete h.maximum),await this.componentDidUpdate(),this.viewExtentUpdated=!1}componentShouldUpdate(...i){const[,,t]=i;this.updatedProps.add(t);const s=!1===this.skipNextUpdate&&!1===this.noRenderProps.includes(t);return this.skipNextUpdate=!1,s}async componentWillLoad(){({strings:this.strings}=await f(this.el,s("."))),this.debouncedChartUpdate=d((async()=>{if(void 0!==this.chart){const i=Array.from(this.updatedProps).some((i=>this.dataUpdateNeededProps.includes(i)));return this.updatedProps.clear(),await this.chart.update({newChartConfig:this.config,updateOptions:y({component:this,dataUpdated:i,viewExtentUpdated:this.viewExtentUpdated}),updateGlobalOptions:w(this)})}}),b)}async componentDidLoad(){void 0!==this.chartRef&&await this.createChartInstance()}async componentDidUpdate(){var i;if(void 0===this.chart&&void 0!==this.chartCreationProcessing&&await this.chartCreationProcessing,await x([c.HistogramSeries],this.config),void 0!==this.config&&void 0!==this.chart&&!1===this.showNotifyPanel)try{const t=null===(i=this.config)||void 0===i?void 0:i.dataSource;l(this.inlineData,t)&&void 0!==this.debouncedChartUpdate&&await this.debouncedChartUpdate.push({})}catch(i){void 0!==this.chartRef&&void 0!==this.config&&(i.name===S.ChartDisposed?(this.chart.dispose(),this.chartRef.innerHTML="",await this.createChartInstance(!1)):(this.errorAlert(null==i?void 0:i.message),i.name===S.QueryFeaturesError&&this.arcgisChartsDataProcessError.emit(i.details)))}else void 0===this.chart&&void 0===this.chartCreationProcessing&&!1===this.showNotifyPanel&&await this.createChartInstance()}async disconnectedCallback(){void 0!==this.chart&&(this.removeLayerListeners(),this.removeExtentChangeListener(),this.chart.dispose())}render(){var i;const t=!0===this.showNotifyPanel?a(C,{heading:this.notifyHeading,message:this.notifyMessage,options:this.notifyOptions}):null,s=!0===this.showNotifyPanel&&"danger"===(null===(i=this.notifyOptions)||void 0===i?void 0:i.kind)?"hide":`${c.HistogramSeries} show`,o=!0===this.showNotifyPanel?"show notifyPanel":"hide";return a(e,null,a("slot",{name:I.actionBar}),a("div",{class:s,ref:i=>{this.chartRef=i}}),a("div",{class:o},t))}dataUpdateIsNeeded(){this.updatedProps.add("forceDataUpdate")}async addLayerListeners(){this.removeLayerListeners(),this.layerFilterListener=await g({layer:this.layer,component:this}),this.layerRendererListener=await p({layer:this.layer,component:this})}async addExtentChangeListener(){this.removeExtentChangeListener(),this.extentChangeListener=await m({view:this.view,layer:this.layer,component:this})}removeLayerListeners(){void 0!==this.layerFilterListener&&this.layerFilterListener.remove(),void 0!==this.layerRendererListener&&this.layerRendererListener.remove()}removeExtentChangeListener(){void 0!==this.extentChangeListener&&this.extentChangeListener.remove()}checkForIncompatibleChartVersion(){var i;const t=null===(i=this.config)||void 0===i?void 0:i.version;D(t).versionStatus===v.Newer&&(this.notifyHeading=this.strings.incompatibleChartVersion.title,this.notifyMessage=M(this.strings.incompatibleChartVersion.message,{chartVersion:null!=t?t:""}),this.notifyOptions={kind:"warning",autoClose:!0,active:!0},this.showNotifyPanel=!0)}async createChartInstance(i=!0){var t,s;await x([c.HistogramSeries],this.config),this.checkForIncompatibleChartVersion(),this.updatedProps.clear();try{const s=null===(t=this.config)||void 0===t?void 0:t.dataSource;l(this.inlineData,s)&&(this.chartCreationProcessing=u({chartContainer:this.chartRef,chartConfig:this.config,options:y({component:this}),globalOptions:w(this)})),this.chart=await this.chartCreationProcessing,!0===i&&(await this.addLayerListeners(),await this.addExtentChangeListener())}catch(i){i.name===S.QueryFeaturesError&&this.arcgisChartsDataProcessError.emit(i.details),this.errorAlert(null==i?void 0:i.message),null===(s=this.chart)||void 0===s||s.dispose(),this.chartCreationProcessing=void 0,this.chart=void 0}}static get assetsDirs(){return["t9n"]}get el(){return o(this)}static get watchers(){return{view:["viewChange"],layer:["layerChange"],legendPosition:["legendPositionChange"],legendVisibility:["legendVisibilityChange"],filterBySelection:["filterBySelectionChanged"]}}};L.style='.hide{display:none}.show{display:block}.notifyPanel{flex:0 1 auto}.histogramSeries{flex-grow:1}.histogramSeries>div{justify-content:center;align-items:center}.histogramSeries .arcgis-charts-modal-inside{padding:1em;padding-left:0}.histogramSeries .arcgis-charts-modal-inside ol{padding-left:2em}.histogramSeries .arcgis-charts-modal-curtain{width:100%;height:100%;position:absolute;top:0px;left:0px;z-index:2001;background-color:white;opacity:0.5;opacity:1}.histogramSeries .arcgis-charts-modal-content{background:rgba(255, 255, 255, 0.8);color:black;display:inline-block;position:absolute;top:0px;left:0px;max-width:90%;max-height:90%;overflow:auto;z-index:2002;position:absolute;max-width:90%;max-height:90%;width:auto !important;height:auto !important;margin:auto !important;inset:auto !important;left:auto !important;top:auto !important}.histogramSeries .arcgis-charts-modal-header{display:block;width:100%;min-height:1.8em;background:rgba(0, 0, 0, 0.05)}.histogramSeries .arcgis-charts-modal-close{display:block;position:absolute;top:0.3em;right:0.3em;background:url("data:image/svg+xml;charset=utf-8;base64,PHN2ZyBoZWlnaHQ9IjUxMiIgdmVyc2lvbj0iMSIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHdpZHRoPSI1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQ0NS4yIDEwOS4ybC00Mi40LTQyLjRMMjU2IDIxMy42IDEwOS4yIDY2LjhsLTQyLjQgNDIuNEwyMTMuNiAyNTYgNjYuOCA0MDIuOGw0Mi40IDQyLjRMMjU2IDI5OC40bDE0Ni44IDE0Ni44IDQyLjQtNDIuNEwyOTguNCAyNTYiLz48L3N2Zz4=") center center/80% no-repeat rgba(100, 100, 100, 0.1);width:1.2em;height:1.2em;cursor:pointer}.histogramSeries .arcgis-charts-modal-title{font-weight:bold;font-size:110%;padding:0.5em 1.2em 0.5em 1em}:host{width:var(--arcgis-charts-histogram-width, var(--arcgis-charts-default-width));height:var(--arcgis-charts-histogram-height, var(--arcgis-charts-default-height));display:flex;flex-direction:row}';export{L as A}