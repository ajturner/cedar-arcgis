import{bQ as e,s as a,dj as r,dh as t}from"./p-b54724b6.js";import{a as n}from"./p-b940e1c6.js";import{getNumLayersAndTables as s,preprocessFSItemData as c,getFirstLayerOrTableId as i,getSubtypeGroupLayerIds as o}from"./p-ea3d1c3e.js";import{t as u}from"./p-4d809a12.js";import"./p-a10686d4.js";async function y(a){!a.portalItem||a.portalItem instanceof e||(a={...a,portalItem:new e(a.portalItem)});const r=await l(a.portalItem);return new r.constructor({portalItem:a.portalItem,...r.properties})}async function l(e){await e.load();return f(await m(e))}async function m(e){switch(e.type){case"Map Service":return p(e);case"Feature Service":return L(e);case"Feature Collection":return w(e);case"Scene Service":return N(e);case"Image Service":return S(e);case"Stream Service":return I();case"Vector Tile Service":return d();case"GeoJson":return g();case"CSV":return b();case"KML":return v();case"WFS":return F();case"WMTS":return T();case"WMS":return M();case"Feed":return j();default:throw new a("portal:unknown-item-type","Unknown item type '${type}'",{type:e.type})}}async function f(e){const a=e.className,r=n[a];return{constructor:await r(),properties:e.properties}}async function p(e){return await V(e)?{className:"TileLayer"}:{className:"MapImageLayer"}}async function L(e){if(r(e,"Oriented Imagery Layer"))return G(e);const a=await W(e);if("object"==typeof a){const e={};return null!=a.id&&(e.layerId=a.id),{className:a.className||"FeatureLayer",properties:e}}return{className:"GroupLayer"}}async function N(e){const a=await W(e);if("object"==typeof a){const r={};let n;if(null!=a.id?(r.layerId=a.id,n=`${e.url}/layers/${a.id}`):n=e.url,e.typeKeywords?.length)for(const a of Object.keys(t))if(e.typeKeywords.includes(a))return{className:t[a]};const s=await u(n);return{className:t[s?.layerType]||"SceneLayer",properties:r}}if(!1===a){const a=await u(e.url);return"Voxel"===a?.layerType?{className:"VoxelLayer"}:{className:"GroupLayer"}}return{className:"GroupLayer"}}async function w(e){await e.load();const a=r(e,"Map Notes"),t=r(e,"Markup");if(a||t)return{className:"MapNotesLayer"};if(r(e,"Route Layer"))return{className:"RouteLayer"};const n=await e.fetchData();return 1===s(n)?{className:"FeatureLayer"}:{className:"GroupLayer"}}async function S(e){await e.load();const a=e.typeKeywords?.map((e=>e.toLowerCase()))??[];if(a.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(a.includes("tiled imagery"))return{className:"ImageryTileLayer"};const r=await e.fetchData(),t=r?.layerType;if("ArcGISTiledImageServiceLayer"===t)return{className:"ImageryTileLayer"};if("ArcGISImageServiceLayer"===t)return{className:"ImageryLayer"};const n=await u(e.url),s=n.cacheType?.toLowerCase(),c=n.capabilities?.toLowerCase().includes("tilesonly");return"map"===s||c?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}}function I(){return{className:"StreamLayer"}}function d(){return{className:"VectorTileLayer"}}function g(){return{className:"GeoJSONLayer"}}function b(){return{className:"CSVLayer"}}function v(){return{className:"KMLLayer"}}function F(){return{className:"WFSLayer"}}function M(){return{className:"WMSLayer"}}function T(){return{className:"WMTSLayer"}}function j(){return{className:"StreamLayer"}}async function G(e){await e.load();return{className:"OrientedImageryLayer",properties:await e.fetchData()}}async function V(e){return(await u(e.url)).tileInfo}async function W(e){const a=e.url;if(!a||/\/\d+$/.test(a))return{};await e.load();const r=await e.fetchData();if("Feature Service"===e.type){const e=O(await c(r,a));if("object"==typeof e){const a=o(r);e.className=null!=e.id&&a.includes(e.id)?"SubtypeGroupLayer":"FeatureLayer"}return e}if(s(r)>0)return O(r);return O(await u(a))}function O(e){return 1===s(e)&&{id:i(e)}}export{y as fromItem,m as selectLayerClassPath};
//# sourceMappingURL=p-9fe551f2.js.map