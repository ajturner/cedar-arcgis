import{bJ as e,l as t,q as l,y as a,n,o as i,b as r}from"./p-b54724b6.js";const o=new e({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),s=new e({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let u=class extends i{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};t([l({classBreaksDef:"class-breaks-definition"})],u.prototype,"type",void 0),t([a({json:{write:!0}})],u.prototype,"breakCount",void 0),t([a({json:{write:!0}})],u.prototype,"classificationField",void 0),t([a({type:String,json:{read:o.read,write:o.write}})],u.prototype,"classificationMethod",void 0),t([a({json:{write:!0}})],u.prototype,"normalizationField",void 0),t([a({json:{read:s.read,write:s.write}})],u.prototype,"normalizationType",void 0),t([a({value:null,json:{write:!0}})],u.prototype,"standardDeviationInterval",null),t([a({value:null,json:{write:!0}})],u.prototype,"definedInterval",null),u=t([n("esri.rest.support.ClassBreaksDefinition")],u);const f=u;const c=r.getLogger("esri.rest.support.generateRendererUtils");function d(e,t){return Number(e.toFixed(t))}function m(e){const t=h(e),l=[],a=t.uniqueValues.length;for(let e=0;e<a;e++){const a=t.uniqueValues[e],n=t.valueFrequency[e],i=a.toString();l.push({value:a,count:n,label:i})}return{uniqueValues:l}}function b(e){const{normalizationTotal:t}=e;return{classBreaks:v(e),normalizationTotal:t}}function v(e){const t=e.definition,{classificationMethod:l,normalizationType:a,definedInterval:n}=t,i=t.breakCount??1,r=[];let o=e.values;if(0===o.length)return[];o=o.sort(((e,t)=>e-t));const s=o[0],u=o[o.length-1];if("equal-interval"===l)if(o.length>=i){const e=(u-s)/i;let t=s;for(let l=1;l<i;l++){const n=d(s+l*e,6);r.push({minValue:t,maxValue:n,label:V(t,n,a)}),t=n}r.push({minValue:t,maxValue:u,label:V(t,u,a)})}else o.forEach((e=>{r.push({minValue:e,maxValue:e,label:V(e,e,a)})}));else if("natural-breaks"===l){const t=h(o),l=e.valueFrequency||t.valueFrequency,n=x(t.uniqueValues,l,i);let f=s;for(let e=1;e<i;e++)if(t.uniqueValues.length>e){const l=d(t.uniqueValues[n[e]],6);r.push({minValue:f,maxValue:l,label:V(f,l,a)}),f=l}r.push({minValue:f,maxValue:u,label:V(f,u,a)})}else if("quantile"===l)if(o.length>=i&&s!==u){let e=s,t=Math.ceil(o.length/i),l=0;for(let n=1;n<i;n++){let s=t+l-1;s>o.length&&(s=o.length-1),s<0&&(s=0),r.push({minValue:e,maxValue:o[s],label:V(e,o[s],a)}),e=o[s],l+=t,t=Math.ceil((o.length-l)/(i-n))}r.push({minValue:e,maxValue:u,label:V(e,u,a)})}else{let e=-1;for(let t=0;t<o.length;t++){const l=o[t];l!==e&&(e=l,r.push({minValue:e,maxValue:l,label:V(e,l,a)}),e=l)}}else if("standard-deviation"===l){const e=k(o),t=q(o,e);if(0===t)r.push({minValue:o[0],maxValue:o[0],label:V(o[0],o[0],a)});else{const l=M(s,u,i,e,t)*t;let n=0,o=s;for(let t=i;t>=1;t--){const i=d(e-(t-.5)*l,6);r.push({minValue:o,maxValue:i,label:V(o,i,a)}),o=i,n++}let f=d(e+.5*l,6);r.push({minValue:o,maxValue:f,label:V(o,f,a)}),o=f,n++;for(let t=1;t<=i;t++)f=n===2*i?u:d(e+(t+.5)*l,6),r.push({minValue:o,maxValue:f,label:V(o,f,a)}),o=f,n++}}else if("defined-interval"===l){if(!n)return r;const e=o[0],t=o[o.length-1],l=Math.ceil((t-e)/n);let i=e;for(let t=1;t<l;t++){const l=d(e+t*n,6);r.push({minValue:i,maxValue:l,label:V(i,l,a)}),i=l}r.push({minValue:i,maxValue:t,label:V(i,t,a)})}return r}function V(e,t,l){let a=null;return a=e===t?l&&"percent-of-total"===l?e+"%":e.toString():l&&"percent-of-total"===l?e+"% - "+t+"%":e+" - "+t,a}function h(e){const t=[],l=[];let a=Number.MIN_VALUE,n=1,i=-1;for(let r=0;r<e.length;r++){const o=e[r];o===a?(n++,l[i]=n):null!==o&&(t.push(o),a=o,n=1,l.push(n),i++)}return{uniqueValues:t,valueFrequency:l}}function x(e,t,l){const a=e.length,n=[];l>a&&(l=a);for(let e=0;e<l;e++)n.push(Math.round(e*a/l-1));n.push(a-1);let i=p(n,e,t,l);return y(i.mean,i.sdcm,n,e,t,l)&&(i=p(n,e,t,l)),n}function p(e,t,l,a){let n=[],i=[],r=[],o=0;const s=[],u=[];for(let n=0;n<a;n++){const a=w(n,e,t,l);s.push(a.sbMean),u.push(a.sbSdcm),o+=u[n]}let f,c=o,d=!0;for(;d||o<c;){d=!1,n=[];for(let t=0;t<a;t++)n.push(e[t]);for(let l=0;l<a;l++)for(let n=e[l]+1;n<=e[l+1];n++)if(f=t[n],l>0&&n!==e[l+1]&&Math.abs(f-s[l])>Math.abs(f-s[l-1]))e[l]=n;else if(l<a-1&&e[l]!==n-1&&Math.abs(f-s[l])>Math.abs(f-s[l+1])){e[l+1]=n-1;break}c=o,o=0,i=[],r=[];for(let n=0;n<a;n++){i.push(s[n]),r.push(u[n]);const a=w(n,e,t,l);s[n]=a.sbMean,u[n]=a.sbSdcm,o+=u[n]}}if(o>c){for(let t=0;t<a;t++)e[t]=n[t],s[t]=i[t],u[t]=r[t];o=c}return{mean:s,sdcm:u}}function y(e,t,l,a,n,i){let r=0,o=0,s=0,u=0,f=!0;for(let c=0;c<2&&f;c++){0===c&&(f=!1);for(let c=0;c<i-1;c++)for(;l[c+1]+1!==l[c+2];){l[c+1]=l[c+1]+1;const i=w(c,l,a,n);s=i.sbMean,r=i.sbSdcm;const d=w(c+1,l,a,n);if(u=d.sbMean,o=d.sbSdcm,!(r+o<t[c]+t[c+1])){l[c+1]=l[c+1]-1;break}t[c]=r,t[c+1]=o,e[c]=s,e[c+1]=u,f=!0}for(let c=i-1;c>0;c--)for(;l[c]!==l[c-1]+1;){l[c]=l[c]-1;const i=w(c-1,l,a,n);s=i.sbMean,r=i.sbSdcm;const d=w(c,l,a,n);if(u=d.sbMean,o=d.sbSdcm,!(r+o<t[c-1]+t[c])){l[c]=l[c]+1;break}t[c-1]=r,t[c]=o,e[c-1]=s,e[c]=u,f=!0}}return f}function M(e,t,l,a,n){let i=Math.max(a-e,t-a)/n/l;return i=i>=1?1:i>=.5?.5:.25,i}function k(e){let t=0;for(let l=0;l<e.length;l++)t+=e[l];return t/=e.length,t}function q(e,t){let l=0;for(let a=0;a<e.length;a++){const n=e[a];l+=(n-t)*(n-t)}l/=e.length;return Math.sqrt(l)}function w(e,t,l,a){let n=0,i=0;for(let r=t[e]+1;r<=t[e+1];r++){const e=a[r];n+=l[r]*e,i+=e}i<=0&&c.warn("Exception in Natural Breaks calculation");const r=n/i;let o=0;for(let n=t[e]+1;n<=t[e+1];n++)o+=a[n]*(l[n]-r)**2;return{sbMean:r,sbSdcm:o}}export{b as a,f as d,m as n};
//# sourceMappingURL=p-1b31d781.js.map