{"version":3,"names":["g","t","r","origins","e","o","s","h","p","type","v","read","write","d","n","i","String","c","url","writer","u","resources","l","y","x","verifyItemRelativeUrls","writtenUrls","rootPath","m","NO","this","origin","originIdOf","a","object","propertyName","value","targetUrl","dest","targetPropertyName","context","params","portalItem","w","j","f","U","filename","prefix","N","resourceFromPath","pendingOperations","push","P","then","path","itemRelativeUrl","catch","compress","I","resource","content","updates","toAdd","toUpdate","toKeep","finish","O","Blob","JSON","stringify","toJSON","async","import","ka","default","data","responseType"],"sources":["./node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{isMultiOriginJSONMixin as t}from\"../../multiOriginJSONSupportUtils.js\";import{isAbsolute as r,isBlobProtocol as e,join as o,getPathExtension as s}from\"../../urlUtils.js\";import{generateUUID as n}from\"../../uuid.js\";import{getPropertyMetadata as i}from\"../metadata.js\";import{nameToId as a}from\"../PropertyOrigin.js\";import{propertyJSONMeta as p}from\"./property.js\";import{getResourceContentExtension as u}from\"../../../portal/support/resourceExtension.js\";import{r as c,t as l,M as m,i as f,p as y,a as d}from\"../../../chunks/persistableUrlUtils.js\";function g(t){const r=t?.origins??[void 0];return(e,o)=>{const s=h(t,e,o);for(const t of r){const r=p(e,t,o);for(const t in s)r[t]=s[t]}}}function h(t,r,e){if(\"resource\"===t?.type)return v(t,r,e);switch(t?.type??\"other\"){case\"other\":return{read:!0,write:!0};case\"url\":{const{read:t,write:r}=d;return{read:t,write:r}}}}function v(o,s,n){const p=i(s,n);return{type:String,read:(t,r,e)=>{const o=c(t,r,e);return p.type===String?o:\"function\"==typeof p.type?new p.type({url:o}):void 0},write:{writer(s,i,u,c){if(!c||!c.resources)return\"string\"==typeof s?void(i[u]=l(s,c)):void(i[u]=s.write({},c));const y=x(s),d=l(y,{...c,verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},m.NO),g=p.type!==String&&(!t(this)||c&&c.origin&&this.originIdOf(n)>a(c.origin)),h={object:this,propertyName:n,value:s,targetUrl:d,dest:i,targetPropertyName:u,context:c,params:o};c&&c.portalItem&&d&&!r(d)?g?w(h):j(h):c&&c.portalItem&&(null==d||null!=f(d)||e(d)||g)?U(h):i[u]=d}}}}function U(t){const{targetUrl:r,params:s,value:i,context:a,dest:p,targetPropertyName:c}=t;if(!a.portalItem)return;const l=y(r),m=l?.filename??n(),f=s?.prefix??l?.prefix,d=N(i,r,a),g=o(f,m),h=`${g}.${u(d)}`,v=a.portalItem.resourceFromPath(h);e(r)&&a.resources&&a.resources.pendingOperations.push(P(r).then((t=>{v.path=`${g}.${u(t)}`,p[c]=v.itemRelativeUrl})).catch((()=>{})));const U=s?.compress??!1;a.resources&&I({...t,resource:v,content:d,compress:U,updates:a.resources.toAdd}),p[c]=v.itemRelativeUrl}function w(t){const{context:r,targetUrl:e,params:o,value:n,dest:i,targetPropertyName:a}=t;if(!r.portalItem)return;const p=r.portalItem.resourceFromPath(e),c=N(n,e,r),l=u(c),m=s(p.path),f=o?.compress??!1;l===m?(r.resources&&I({...t,resource:p,content:c,compress:f,updates:r.resources.toUpdate}),i[a]=e):U(t)}function j({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function I({object:t,propertyName:r,updates:e,resource:o,content:s,compress:n}){e.push({resource:o,content:s,compress:n,finish:e=>{O(t,r,e)}})}function N(t,r,e){return\"string\"==typeof t?{url:r}:new Blob([JSON.stringify(t.toJSON(e))],{type:\"application/json\"})}async function P(t){const r=(await import(\"../../../request.js\")).default,{data:e}=await r(t,{responseType:\"blob\"});return e}function x(t){return null==t?null:\"string\"==typeof t?t:t.url}function O(t,r,e){\"string\"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{g as persistable};\n"],"mappings":"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"}