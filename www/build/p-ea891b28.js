import{T as t,G as e,N as n,Z as r,f as a,Q as i,Y as o,e as s,o as c,C as u,R as l,O as f,p as w,F as h,z as d,L as p,q as y,A as v,E as m,V as b,D as x,b as S,J as g,a as R,c as E,W as I,d as j,g as k,i as F,h as M,y as A,r as C,s as D,n as P,j as T,k as V}from"./p-122f2dcc.js";import{t as B,e as G,u as L}from"./p-623dbe5e.js";import{registerFunctions as U}from"./p-60847726.js";import{aU as q,b0 as N}from"./p-b54724b6.js";import"./p-2f568dc7.js";import"./p-70146138.js";import"./p-a3f0a5f3.js";import"./p-e6a64715.js";import"./p-dc29c329.js";import"./p-3ba72354.js";import"./p-f89e9181.js";const W=100;async function z(t,e){const n=[];for(let r=0;r<e.arguments.length;r++)n.push(await Y(t,e.arguments[r]));return n}async function H(t,e,n){if(!0===e.preparsed)return n(t,null,e.arguments);return n(t,e,await z(t,e))}class J extends C{constructor(t,e){super(),this.definition=null,this.context=null,this.definition=t,this.context=e}createFunction(t){return(...e)=>{const n={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeReference:this.context.timeReference??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:t.depthCounter+1},globalScope:this.context.globalScope};if(n.depthCounter.depth>64)throw new B(t,G.MaximumCallDepth,null);return Vt(this.definition,n,e,null)}}call(t,e){return Q(t,e,((n,r,a)=>{const i={spatialReference:t.spatialReference,services:t.services,console:t.console,libraryResolver:t.libraryResolver,exports:t.exports,lrucache:t.lrucache,timeReference:t.timeReference??null,interceptor:t.interceptor,localScope:{},abortSignal:t.abortSignal,globalScope:t.globalScope,depthCounter:{depth:t.depthCounter.depth+1}};if(i.depthCounter.depth>64)throw new B(t,G.MaximumCallDepth,e);return Vt(this.definition,i,a,e)}))}marshalledCall(t,e,n,r){return r(t,e,(async(a,i,o)=>{const s={spatialReference:t.spatialReference,globalScope:n.globalScope,depthCounter:{depth:t.depthCounter.depth+1},libraryResolver:t.libraryResolver,exports:t.exports,console:t.console,abortSignal:t.abortSignal,lrucache:t.lrucache,timeReference:t.timeReference??null,interceptor:t.interceptor,localScope:{}};return o=o.map((e=>!f(e)||e instanceof D?e:P(e,t,r))),P(await Vt(this.definition,s,o,e),n,r)}))}}class O extends T{constructor(t){super(t)}async global(t){const e=this.executingContext.globalScope[t.toLowerCase()];if(e.valueset||(e.value=await Y(this.executingContext,e.node),e.valueset=!0),f(e.value)&&!(e.value instanceof D)){const t=new D;t.fn=e.value,t.parameterEvaluator=Q,t.context=this.executingContext,e.value=t}return e.value}setGlobal(t,e){if(f(e))throw new B(null,G.AssignModuleFunction,null);this.executingContext.globalScope[t.toLowerCase()]={value:e,valueset:!0,node:null}}hasGlobal(t){return void 0===this.executingContext.exports[t]&&(t=t.toLowerCase()),void 0!==this.executingContext.exports[t]}async loadModule(t){let e=t.spatialReference;null==e&&(e=new q({wkid:102100})),this.moduleScope=Lt({},t.customfunctions,t.timeReference),this.executingContext={spatialReference:e,services:t.services,libraryResolver:new V(t.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===t.abortSignal||null===t.abortSignal?{aborted:!1}:t.abortSignal,globalScope:this.moduleScope,console:t.console??Ut,lrucache:t.lrucache,timeReference:t.timeReference??null,interceptor:t.interceptor,localScope:null,depthCounter:{depth:1}},await Y(this.executingContext,this.source.syntax)}}async function Q(t,e,n){if(!0===e.preparsed){const r=n(t,null,e.arguments);return r}const r=n(t,e,await z(t,e));return r}async function Y(t,e,n){if(e.breakpoint&&!0!==n){const n=e.breakpoint();return await n,Y(t,e,!0)}try{switch(e?.type){case"VariableDeclarator":return await St(t,e);case"ImportDeclaration":return await mt(t,e);case"ExportNamedDeclaration":return await bt(t,e);case"VariableDeclaration":return await xt(t,e,0);case"BlockStatement":case"Program":return await dt(t,e);case"FunctionDeclaration":return await vt(t,e);case"ReturnStatement":return await yt(t,e);case"IfStatement":return await ht(t,e);case"ExpressionStatement":return await wt(t,e);case"UpdateExpression":return await ut(t,e);case"AssignmentExpression":return await ft(t,e);case"ForStatement":return await et(t,e);case"WhileStatement":return await X(t,e);case"ForInStatement":return await ct(t,e);case"BreakStatement":return u;case"EmptyStatement":return h;case"ContinueStatement":return l;case"TemplateElement":return await Mt(t,e);case"TemplateLiteral":return await Ct(t,e);case"Identifier":return await kt(t,e);case"MemberExpression":return await gt(t,e);case"Literal":return e.value;case"CallExpression":return await Ft(t,e);case"UnaryExpression":return await Rt(t,e);case"BinaryExpression":return await It(t,e);case"LogicalExpression":return await jt(t,e);case"ArrayExpression":return await Et(t,e);case"ObjectExpression":return await Z(t,e);case"Property":return await K(t,e);default:throw new B(t,G.Unrecognised,e)}}catch(n){throw L(t,e,n)}}async function Z(t,e){const n=[];for(let r=0;r<e.properties.length;r++)n[r]=await Y(t,e.properties[r]);const r={},a=new Map;for(let i=0;i<n.length;i++){const o=n[i];if(f(o.value))throw new B(t,G.NoFunctionInDictionary,e);if(!1===p(o.key))throw new B(t,G.KeyMustBeString,e);let s=o.key.toString();const c=s.toLowerCase();a.has(c)?s=a.get(c):a.set(c,s),o.value===h?r[s]=null:r[s]=o.value}const i=new v(r);return i.immutable=!1,i}async function K(t,e){const n=await Y(t,e.value);if("Identifier"===e.key.type)return{key:e.key.name,value:n};return{key:await Y(t,e.key),value:n}}async function X(t,e){const n={testResult:!0,lastAction:h};if(n.testResult=await Y(t,e.test),!1===n.testResult)return h;if(!0!==n.testResult)throw new B(t,G.BooleanConditionRequired,e);for(;!0===n.testResult&&(n.lastAction=await Y(t,e.body),n.lastAction!==u)&&!(n.lastAction instanceof x);)if(n.testResult=await Y(t,e.test),!0!==n.testResult&&!1!==n.testResult)throw new B(t,G.BooleanConditionRequired,e);return n.lastAction instanceof x?n.lastAction:h}async function $(t,e,n){const r=await Y(t,e.body);return n.lastAction=r,n.lastAction===u||n.lastAction instanceof x?(n.testResult=!1,n):null!==e.update?(await Y(t,e.update),n):n}async function _(t,e,n){if(null!==e.test){const r=await Y(t,e.test);if(!0===t.abortSignal?.aborted)throw new B(t,G.Cancelled,e);if(n.testResult=r,!1===n.testResult)return n;if(!0!==n.testResult)throw new B(t,G.BooleanConditionRequired,e);return $(t,e,n)}return $(t,e,n)}function tt(t,e,n,r,a,i){try{_(t,e,n).then((()=>{try{!0===n.testResult?++i>W?(i=0,setTimeout((()=>{tt(t,e,n,r,a,i)}),0)):tt(t,e,n,r,a,i):n.lastAction instanceof x?r(n.lastAction):r(h)}catch(t){a(t)}}),(t=>{a(t)}))}catch(t){a(t)}}function et(t,e){try{return null!==e.init?Y(t,e.init).then((()=>new Promise(((n,r)=>{tt(t,e,{testResult:!0,lastAction:h},(t=>{n(t)}),(t=>{r(t)}),0)})))):new Promise(((n,r)=>{tt(t,e,{testResult:!0,lastAction:h},(t=>{n(t)}),(t=>{r(t)}),0)}))}catch(t){return Promise.reject(t)}}function nt(t,e,n,r,a,i,o,s,c,l){try{if(r<=i)return void s(h);a.value="k"===o?n[i]:i,Y(t,e.body).then((f=>{try{f instanceof x?s(f):f===u?s(h):++l>W?(l=0,setTimeout((()=>{nt(t,e,n,r,a,i+1,o,s,c,l)}),0)):nt(t,e,n,r,a,i+1,o,s,c,l)}catch(t){c(t)}}),(t=>{c(t)}))}catch(t){c(t)}}function rt(t,e,n,r,a,i,o,s,c){try{if(n.length()<=a)return void o(h);r.value="k"===i?n.get(a):a,Y(t,e.body).then((l=>{l instanceof x?o(l):l===u?o(h):++c>W?(c=0,setTimeout((()=>{rt(t,e,n,r,a+1,i,o,s,c)}),0)):rt(t,e,n,r,a+1,i,o,s,c)}),(t=>{s(t)}))}catch(t){s(t)}}function at(t,e,n,r,a,i){try{if(void 0===i&&(i="i"),0===n.length)return void r.resolve(h);nt(t,e,n,n.length,a,0,i,(t=>{r.resolve(t)}),(t=>{r.reject(t)}),0)}catch(t){r.reject(t)}}function it(t,e,n,r,a,i){try{if(void 0===i&&(i="i"),0===n.length)return void r.resolve(h);rt(t,e,n,a,0,i,(t=>{r.resolve(t)}),(t=>{r.reject(t)}),0)}catch(t){r.reject(t)}}function ot(t,e,n,r,a){try{at(t,e,n.keys(),r,a,"k")}catch(t){r.reject(t)}}function st(t,e,n,r,a,i,o,s){try{t.next().then((c=>{try{if(null===c)i(h);else{const l=S.createFromGraphicLikeObject(c.geometry,c.attributes,r,e.timeReference);l._underlyingGraphic=c,a.value=l;Y(e,n.body).then((c=>{try{c===u?i(h):c instanceof x?i(c):++s>W?(s=0,setTimeout((()=>{st(t,e,n,r,a,i,o,s)}),0)):st(t,e,n,r,a,i,o,s)}catch(t){o(t)}}),(t=>{o(t)}))}}catch(t){o(t)}}),(t=>{o(t)}))}catch(t){o(t)}}async function ct(t,e){return new Promise(((n,r)=>{Y(t,e.right).then((a=>{try{let i=null;i="VariableDeclaration"===e.left.type?Y(t,e.left):Promise.resolve(),i.then((()=>{try{let i="";if("VariableDeclaration"===e.left.type){const t=e.left.declarations[0].id;"Identifier"===t.type&&(i=t.name)}else"Identifier"===e.left.type&&(i=e.left.name);if(!i)throw new B(t,G.InvalidIdentifier,e);i=i.toLowerCase();let o=null;if(null!=t.localScope&&void 0!==t.localScope[i]&&(o=t.localScope[i]),null===o&&void 0!==t.globalScope[i]&&(o=t.globalScope[i]),null===o)return void r(new B(t,G.InvalidIdentifier,e));d(a)||p(a)?at(t,e,a,{reject:r,resolve:n},o):y(a)?it(t,e,a,{reject:r,resolve:n},o):a instanceof v||m(a)?ot(t,e,a,{reject:r,resolve:n},o):b(a)?st(a.iterator(t.abortSignal),t,e,a,o,(t=>{n(t)}),(t=>{r(t)}),0):at(t,e,[],{reject:r,resolve:n},o)}catch(t){r(t)}}),r)}catch(t){r(t)}}),r)}))}async function ut(t,e){const n=e.argument;if("MemberExpression"===n.type){const r={t:null},a=await Y(t,n.object);let i=null;r.t=a,!0===n.computed?i=await Y(t,n.property):"Identifier"===n.property.type&&(i=n.property.name);const o=r.t;let s;if(d(o)){if(!g(i))throw new B(t,G.ArrayAccessorMustBeNumber,e);if(i<0&&(i=o.length+i),i<0||i>=o.length)throw new B(t,G.OutOfBounds,e);s=R(o[i]),o[i]="++"===e.operator?s+1:s-1}else if(o instanceof v){if(!1===p(i))throw new B(t,G.KeyAccessorMustBeString,e);if(!0!==o.hasField(i))throw new B(t,G.FieldNotFound,e,{key:i});s=R(o.field(i)),o.setField(i,"++"===e.operator?s+1:s-1)}else if(o instanceof O){if(!1===p(i))throw new B(t,G.ModuleAccessorMustBeString,e);if(!0!==o.hasGlobal(i))throw new B(t,G.ModuleExportNotFound,e);s=R(await o.global(i)),o.setGlobal(i,"++"===e.operator?s+1:s-1)}else{if(!m(o))throw y(o)?new B(t,G.Immutable,e):new B(t,G.InvalidParameter,e);if(!1===p(i))throw new B(t,G.KeyAccessorMustBeString,e);if(!0!==o.hasField(i))throw new B(t,G.FieldNotFound,e,{key:i});s=R(o.field(i)),o.setField(i,"++"===e.operator?s+1:s-1)}return!1===e.prefix?s:"++"===e.operator?s+1:s-1}const r="Identifier"===e.argument.type?e.argument.name.toLowerCase():"";if(!r)throw new B(t,G.InvalidIdentifier,e);let a;if(null!=t.localScope&&void 0!==t.localScope[r])return a=R(t.localScope[r].value),t.localScope[r]={value:"++"===e.operator?a+1:a-1,valueset:!0,node:e},!1===e.prefix?a:"++"===e.operator?a+1:a-1;if(void 0!==t.globalScope[r])return a=R(t.globalScope[r].value),t.globalScope[r]={value:"++"===e.operator?a+1:a-1,valueset:!0,node:e},!1===e.prefix?a:"++"===e.operator?a+1:a-1;throw new B(t,G.InvalidIdentifier,e)}function lt(t,e,n,r,a){switch(e){case"=":return t===h?null:t;case"/=":return R(n)/R(t);case"*=":return R(n)*R(t);case"-=":return R(n)-R(t);case"+=":return p(n)||p(t)?j(n)+j(t):R(n)+R(t);case"%=":return R(n)%R(t);default:throw new B(a,G.UnsupportedOperator,r)}}async function ft(t,e){const n=e.left;if("MemberExpression"===n.type){const r=await Y(t,n.object);let a=null;if(!0===n.computed)a=await Y(t,n.property);else{if("Identifier"!==n.property.type)throw new B(t,G.InvalidIdentifier,e);a=n.property.name}const i=await Y(t,e.right);if(d(r)){if(!g(a))throw new B(t,G.ArrayAccessorMustBeNumber,e);if(a<0&&(a=r.length+a),a<0||a>r.length)throw new B(t,G.OutOfBounds,e);if(a===r.length){if("="!==e.operator)throw new B(t,G.OutOfBounds,e);r[a]=lt(i,e.operator,r[a],e,t)}else r[a]=lt(i,e.operator,r[a],e,t)}else if(r instanceof v){if(!1===p(a))throw new B(t,G.KeyAccessorMustBeString,e);if(!0===r.hasField(a))r.setField(a,lt(i,e.operator,r.field(a),e,t));else{if("="!==e.operator)throw new B(t,G.FieldNotFound,e,{key:a});r.setField(a,lt(i,e.operator,null,e,t))}}else if(r instanceof O){if(!1===p(a))throw new B(t,G.KeyAccessorMustBeString,e);if(!0!==r.hasGlobal(a))throw new B(t,G.ModuleExportNotFound,e);r.setGlobal(a,lt(i,e.operator,await r.global(a),e,t))}else{if(!m(r))throw y(r)?new B(t,G.Immutable,e):new B(t,G.InvalidParameter,e);if(!1===p(a))throw new B(t,G.KeyAccessorMustBeString,e);if(!0===r.hasField(a))r.setField(a,lt(i,e.operator,r.field(a),e,t));else{if("="!==e.operator)throw new B(t,G.FieldNotFound,e,{key:a});r.setField(a,lt(i,e.operator,null,e,t))}}return h}const r=n.name.toLowerCase();if(null!=t.localScope&&void 0!==t.localScope[r]){const n=await Y(t,e.right);return t.localScope[r]={value:lt(n,e.operator,t.localScope[r].value,e,t),valueset:!0,node:e.right},h}if(void 0!==t.globalScope[r]){const n=await Y(t,e.right);return t.globalScope[r]={value:lt(n,e.operator,t.globalScope[r].value,e,t),valueset:!0,node:e.right},h}throw new B(t,G.InvalidIdentifier,e)}async function wt(t,e){if("AssignmentExpression"===e.expression.type)return Y(t,e.expression);if("CallExpression"===e.expression.type){const n=await Y(t,e.expression);return n===h?h:new E(n)}const n=await Y(t,e.expression);return n===h?h:new E(n)}async function ht(t,e){const n=await Y(t,e.test);if(!0===n)return Y(t,e.consequent);if(!1===n)return null!==e.alternate?Y(t,e.alternate):h;throw new B(t,G.BooleanConditionRequired,e)}async function dt(t,e){return pt(t,e,0)}async function pt(t,e,n){if(n>=e.body.length)return h;const r=await Y(t,e.body[n]);return r instanceof x||r===u||r===l||n===e.body.length-1?r:pt(t,e,n+1)}async function yt(t,e){if(null===e.argument)return new x(h);const n=await Y(t,e.argument);return new x(n)}async function vt(t,e){const n=e.id.name.toLowerCase();return t.globalScope[n]={valueset:!0,node:null,value:new J(e,t)},h}async function mt(t,e){const n=e.specifiers[0].local.name.toLowerCase(),r=t.libraryResolver.loadLibrary(n);let a=null;return t.libraryResolver._moduleSingletons?.has(r.uri)?a=t.libraryResolver._moduleSingletons.get(r.uri):(a=new O(r),await a.loadModule(t),t.libraryResolver._moduleSingletons?.set(r.uri,a)),t.globalScope[n]={value:a,valueset:!0,node:e},h}async function bt(t,e){if(await Y(t,e.declaration),"FunctionDeclaration"===e.declaration.type)t.exports[e.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===e.declaration.type)for(const n of e.declaration.declarations)t.exports[n.id.name.toLowerCase()]="variable";return h}async function xt(t,e,n){return n>=e.declarations.length?h:(await Y(t,e.declarations[n]),n===e.declarations.length-1||await xt(t,e,n+1),h)}async function St(t,e){let n=null;if(n=null===e.init?null:await Y(t,e.init),null!==t.localScope){if(n===h&&(n=null),"Identifier"!==e.id.type)throw new B(t,G.InvalidIdentifier,e);const r=e.id.name.toLowerCase();return null!=t.localScope&&(t.localScope[r]={value:n,valueset:!0,node:e.init}),h}if("Identifier"!==e.id.type)throw new B(t,G.InvalidIdentifier,e);const r=e.id.name.toLowerCase();return n===h&&(n=null),t.globalScope[r]={value:n,valueset:!0,node:e.init},h}async function gt(t,e){const n=await Y(t,e.object);if(null===n)throw new B(t,G.MemberOfNull,e);if(!1===e.computed){if("Identifier"===e.property.type){if(n instanceof v||m(n))return n.field(e.property.name);if(n instanceof N)return I(n,e.property.name,t,e);if(n instanceof O){if(!n.hasGlobal(e.property.name))throw new B(t,G.InvalidIdentifier,e);return n.global(e.property.name)}throw new B(t,G.InvalidMemberAccessKey,e)}throw new B(t,G.InvalidMemberAccessKey,e)}let r=await Y(t,e.property);if(n instanceof v||m(n)){if(p(r))return n.field(r);throw new B(t,G.InvalidMemberAccessKey,e)}if(n instanceof O){if(p(r))return n.global(r);throw new B(t,G.InvalidMemberAccessKey,e)}if(n instanceof N){if(p(r))return I(n,r,t,e);throw new B(t,G.InvalidMemberAccessKey,e)}if(d(n)){if(g(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new B(t,G.OutOfBounds,e);return n[r]}throw new B(t,G.InvalidMemberAccessKey,e)}if(y(n)){if(g(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length()+r),r>=n.length()||r<0)throw new B(t,G.OutOfBounds,e);return n.get(r)}throw new B(t,G.InvalidMemberAccessKey,e)}if(p(n)){if(g(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new B(t,G.OutOfBounds,e);return n[r]}throw new B(t,G.InvalidMemberAccessKey,e)}throw new B(t,G.InvalidMemberAccessKey,e)}async function Rt(t,e){const n=await Y(t,e.argument);if(o(n)){if("!"===e.operator)return!n;if("-"===e.operator)return-1*R(n);if("+"===e.operator)return 1*R(n);if("~"===e.operator)return~R(n);throw new B(t,G.UnsupportedUnaryOperator,e)}if("-"===e.operator)return-1*R(n);if("+"===e.operator)return 1*R(n);if("~"===e.operator)return~R(n);throw new B(t,G.UnsupportedUnaryOperator,e)}async function Et(t,e){const n=[];for(let r=0;r<e.elements.length;r++)n.push(await Y(t,e.elements[r]));for(let r=0;r<n.length;r++){if(f(n[r]))throw new B(t,G.NoFunctionInArray,e);n[r]===h&&(n[r]=null)}return n}async function It(t,e){const n=[];n[0]=await Y(t,e.left),n[1]=await Y(t,e.right);const r=n[0],a=n[1];switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return M(R(r),R(a),e.operator);case"==":return F(r,a);case"!=":return!F(r,a);case"<":case">":case"<=":case">=":return k(r,a,e.operator);case"+":return p(r)||p(a)?j(r)+j(a):R(r)+R(a);case"-":return R(r)-R(a);case"*":return R(r)*R(a);case"/":return R(r)/R(a);case"%":return R(r)%R(a);default:throw new B(t,G.UnsupportedOperator,e)}}async function jt(t,e){const n=await Y(t,e.left);let r=null;if(!o(n))throw new B(t,G.LogicalExpressionOnlyBoolean,e);switch(e.operator){case"||":if(!0===n)return n;if(r=await Y(t,e.right),o(r))return r;throw new B(t,G.LogicExpressionOrAnd,e);case"&&":if(!1===n)return n;if(r=await Y(t,e.right),o(r))return r;throw new B(t,G.LogicExpressionOrAnd,e);default:throw new B(t,G.LogicExpressionOrAnd,e)}}async function kt(t,e){const n=e.name.toLowerCase();if(null!=t.localScope&&void 0!==t.localScope[n]){const e=t.localScope[n];if(!0===e.valueset)return e.value;if(null!==e.d)return e.d;e.d=Y(t,e.node);const r=await e.d;return e.value=r,e.valueset=!0,r}if(void 0!==t.globalScope[n]){const e=t.globalScope[n];if(!0===e.valueset)return e.value;if(null!==e.d)return e.d;e.d=Y(t,e.node);const r=await e.d;return e.value=r,e.valueset=!0,r}throw new B(t,G.InvalidIdentifier,e)}async function Ft(t,e){if("MemberExpression"===e.callee.type){const n=await Y(t,e.callee.object);if(!(n instanceof O))throw new B(t,G.FunctionNotFound,e);const r=!1===e.callee.computed?e.callee.property.name:await Y(t,e.callee.property);if(!n.hasGlobal(r))throw new B(t,G.FunctionNotFound,e);const a=await n.global(r);if(!f(a))throw new B(t,G.CallNonFunction,e);return a.call(t,e)}if("Identifier"!==e.callee.type)throw new B(t,G.FunctionNotFound,e);if(null!=t.localScope&&void 0!==t.localScope[e.callee.name.toLowerCase()]){const n=t.localScope[e.callee.name.toLowerCase()];if(f(n.value))return n.value.call(t,e);throw new B(t,G.CallNonFunction,e)}if(void 0!==t.globalScope[e.callee.name.toLowerCase()]){const n=t.globalScope[e.callee.name.toLowerCase()];if(f(n.value))return n.value.call(t,e);throw new B(t,G.CallNonFunction,e)}throw new B(t,G.FunctionNotFound,e)}async function Mt(t,e){return e.value?e.value.cooked:""}function At(t,e,n){if(f(t))throw new B(e,G.NoFunctionInTemplateLiteral,n);return t}async function Ct(t,e){const n=[];for(let r=0;r<e.expressions.length;r++){const a=await Y(t,e.expressions[r]);n[r]=j(a)}let r="",a=0;for(const i of e.quasis)if(r+=i.value?i.value.cooked:"",!1===i.tail){r+=n[a]?At(n[a],t,e):"",a++}return r}const Dt={};async function Pt(t,e,n,r){const a=await Y(t,e.arguments[n]);if(F(a,r))return Y(t,e.arguments[n+1]);const i=e.arguments.length-n;return 1===i?Y(t,e.arguments[n]):2===i?null:3===i?Y(t,e.arguments[n+2]):Pt(t,e,n+2,r)}async function Tt(t,e,n,r){if(!0===r)return Y(t,e.arguments[n+1]);if(3===e.arguments.length-n)return Y(t,e.arguments[n+2]);const a=await Y(t,e.arguments[n+2]);if(!1===o(a))throw new B(t,G.ModuleExportNotFound,e.arguments[n+2]);return Tt(t,e,n+2,a)}async function Vt(t,e,n,r){const a=t.body;if(n.length!==t.params.length)throw new B(e,G.WrongNumberOfParameters,null);for(let r=0;r<n.length;r++){const a=t.params[r];"Identifier"===a.type&&null!=e.localScope&&(e.localScope[a.name.toLowerCase()]={d:null,value:n[r],valueset:!0,node:null})}const i=await Y(e,a);if(i instanceof x)return i.value;if(i===u)throw new B(e,G.UnexpectedToken,r);if(i===l)throw new B(e,G.UnexpectedToken,r);return i instanceof E?i.value:i}t(Dt,H),e(Dt,H),n(Dt,H),r(Dt,H),a(Dt,H),U({functions:Dt,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:H,standardFunctionAsync:Q}),Dt.iif=async function(t,e){i(null===e.arguments?[]:e.arguments,3,3,t,e);const n=await Y(t,e.arguments[0]);if(!1===o(n))throw new B(t,G.BooleanConditionRequired,e);return Y(t,n?e.arguments[1]:e.arguments[2])},Dt.decode=async function(t,e){if(e.arguments.length<2)throw new B(t,G.WrongNumberOfParameters,e);if(2===e.arguments.length)return Y(t,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new B(t,G.WrongNumberOfParameters,e);return Pt(t,e,1,await Y(t,e.arguments[0]))},Dt.when=async function(t,e){if(e.arguments.length<3)throw new B(t,G.WrongNumberOfParameters,e);if(e.arguments.length%2==0)throw new B(t,G.WrongNumberOfParameters,e);const n=await Y(t,e.arguments[0]);if(!1===o(n))throw new B(t,G.BooleanConditionRequired,e.arguments[0]);return Tt(t,e,0,n)};const Bt={fixSpatialReference:A,parseArguments:z,standardFunction:H,standardFunctionAsync:Q,evaluateIdentifier:kt};for(const t in Dt)Dt[t]={value:new s(Dt[t]),valueset:!0,node:null};const Gt=function(){};function Lt(t,e,n){const r=new Gt;null==t&&(t={}),null==e&&(e={});const a=new v({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,r.textformatting={value:a,valueset:!0,node:null};for(const t in e)r[t]={value:new s(e[t]),native:!0,valueset:!0,node:null};for(const e in t)t[e]&&"esri.Graphic"===t[e].declaredClass?r[e]={value:S.createFromGraphic(t[e],n),valueset:!0,node:null}:r[e]={value:t[e],valueset:!0,node:null};return r}function Ut(t){console.log(t)}Gt.prototype=Dt,Gt.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Gt.prototype.pi={value:Math.PI,valueset:!0,node:null};const qt=Bt;function Nt(t){const e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:H,standardFunctionAsync:Q,evaluateIdentifier:kt};for(let n=0;n<t.length;n++)t[n].registerFunctions(e);for(const t in e.functions)Dt[t]={value:new s(e.functions[t]),valueset:!0,node:null},Gt.prototype[t]=Dt[t];for(let t=0;t<e.signatures.length;t++)c(e.signatures[t],"async")}async function Wt(t,e){let n=e.spatialReference;null==n&&(n=new q({wkid:102100}));let r=null;t.usesModules&&(r=new V(new Map,t.loadedModules));const a=Lt(e.vars,e.customfunctions,e.timeReference),i={spatialReference:n,services:e.services,exports:{},libraryResolver:r,abortSignal:void 0===e.abortSignal||null===e.abortSignal?{aborted:!1}:e.abortSignal,globalScope:a,console:e.console??Ut,timeReference:e.timeReference??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}};let o=await Y(i,t);if(o instanceof x&&(o=o.value),o instanceof E&&(o=o.value),o===h&&(o=null),o===u)throw new B(i,G.IllegalResult,null);if(o===l)throw new B(i,G.IllegalResult,null);if(f(o))throw new B(i,G.IllegalResult,null);return o}Nt([w]);export{Wt as executeScript,Nt as extend,qt as functionHelper};
//# sourceMappingURL=p-ea891b28.js.map