import{l as t,y as p,he as i,n as s,Q as r,b as e,ad as o}from"./p-b54724b6.js";import{i as a}from"./p-c8e3775b.js";import{a as m}from"./p-68411adb.js";import{f as j,d as h}from"./p-5f5f43c2.js";import{o as c}from"./p-8b9c0412.js";import{n as d}from"./p-cbd322b3.js";import{v as f}from"./p-fe46c115.js";import{m as n}from"./p-95a83697.js";import{a as b}from"./p-3faf3e32.js";import{U as l,r as u}from"./p-2db16041.js";import"./p-0fe6a545.js";import"./p-07f12c16.js";import"./p-570a8a46.js";import"./p-1fd43aa6.js";import"./p-49f0006c.js";import"./p-541ec65c.js";import"./p-13e550f5.js";import"./p-795f7c81.js";import"./p-29040467.js";import"./p-0e94eaa4.js";import"./p-33c0f331.js";import"./p-9f1a0adc.js";import"./p-5b0b1d68.js";import"./p-4f76b2d1.js";import"./p-2d1dac84.js";import"./p-42c332a2.js";import"./p-843f0c78.js";import"./p-38e70926.js";import"./p-74887bd8.js";import"./p-783b6965.js";import"./p-a3f0a5f3.js";import"./p-e6a64715.js";import"./p-dc29c329.js";import"./p-6ffbaa7a.js";import"./p-fc9cd10b.js";import"./p-fdc41b20.js";import"./p-ecc7ed03.js";import"./p-05938a61.js";import"./p-8043ab9b.js";import"./p-faf4e331.js";import"./p-cd4a8b9a.js";import"./p-cae2235f.js";import"./p-9a4094ba.js";import"./p-1184cc61.js";import"./p-98e621d1.js";import"./p-1b31d781.js";import"./p-f7f8e6f9.js";import"./p-a779e49b.js";import"./p-7572c366.js";import"./p-832f907c.js";import"./p-5abe9c67.js";import"./p-0856fe30.js";import"./p-a5e3ec2a.js";import"./p-80be55a5.js";import"./p-b88ddb1e.js";import"./p-8dc3148c.js";import"./p-ca5fb53c.js";import"./p-d7fc78fa.js";import"./p-581eca80.js";import"./p-2a2efb66.js";import"./p-1701e549.js";import"./p-07a1e707.js";import"./p-8bc47c76.js";import"./p-c19b935f.js";import"./p-e75aa2b5.js";import"./p-f5f26b1f.js";import"./p-52a9dec5.js";import"./p-a379c2ce.js";import"./p-399020b7.js";import"./p-50b034e8.js";import"./p-6bb7b693.js";import"./p-de65627f.js";import"./p-791e5c7c.js";import"./p-89e4900b.js";import"./p-8eb5caaf.js";import"./p-c6ce33a2.js";import"./p-b6ec07fb.js";import"./p-b3dc802f.js";import"./p-db174923.js";import"./p-8eafbd05.js";import"./p-015ba93b.js";import"./p-fb79aaf0.js";import"./p-5977fcaf.js";import"./p-873e8cec.js";import"./p-21ae9bf7.js";import"./p-2a6d626a.js";import"./p-0357efed.js";import"./p-2f568dc7.js";import"./p-623dbe5e.js";import"./p-ae4c1e05.js";import"./p-a3e88624.js";import"./p-58405edc.js";import"./p-b4b7d6a0.js";import"./p-cc8b27b8.js";import"./p-6b09cddc.js";import"./p-053dc63d.js";import"./p-5d1ac384.js";import"./p-52324761.js";const g=r=>{let e=class extends r{initialize(){this.exportImageParameters=new n({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return t([p()],e.prototype,"exportImageParameters",void 0),t([p({readOnly:!0})],e.prototype,"floors",null),t([p({readOnly:!0})],e.prototype,"exportImageVersion",null),t([p()],e.prototype,"layer",void 0),t([p()],e.prototype,"suspended",void 0),t([p(i)],e.prototype,"timeExtent",void 0),e=t([s("esri.views.layers.MapImageLayerView")],e),e};let y=class extends(g(b(j(h)))){constructor(){super(...arguments),this._highlightGraphics=new a,this._updateHash=""}fetchPopupFeatures(t,p){return this._popupHighlightHelper.fetchPopupFeatures(t,p)}update(t){const p=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==p&&(this._updateHash=p,this.strategy.update(t).catch((t=>{r(t)||e.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:p,version:i}=this.layer,s=i>=10.3,r=i>=10;this._bitmapContainer=new m,this.container.addChild(this._bitmapContainer),this._highlightView=new c({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new d(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new l({createFetchPopupFeaturesQueryGeometry:(t,p)=>u(t,p,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,p)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:p})},layerView:this,updatingHandles:this.updatingHandles}),this.strategy=new f({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:p,imageRotationSupported:s,imageNormalizationSupported:r,hidpi:!0}),this.addAttachHandles(o((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,p,i,s){return this.layer.fetchImage(t,p,i,{timeExtent:this.timeExtent,floors:this.floors,...s})}fetchImageBitmap(t,p,i,s){return this.layer.fetchImageBitmap(t,p,i,{timeExtent:this.timeExtent,floors:this.floors,...s})}highlight(t){return this._popupHighlightHelper.highlight(t)}};t([p()],y.prototype,"strategy",void 0),t([p()],y.prototype,"updating",void 0),y=t([s("esri.views.2d.layers.MapImageLayerView2D")],y);const x=y;export default x;
//# sourceMappingURL=p-f3d4d219.js.map