import{M as t,V as s,R as p,ad as i,ae as r,au as o,l as e,n as a}from"./p-b54724b6.js";import{h as m}from"./p-843f0c78.js";import{r as c}from"./p-1aba1165.js";import{f as j,d as h}from"./p-5f5f43c2.js";import{i as f}from"./p-add7d66d.js";import{o as n}from"./p-8b9c0412.js";import"./p-07f12c16.js";import"./p-570a8a46.js";import"./p-13e550f5.js";import"./p-49f0006c.js";import"./p-541ec65c.js";import"./p-0fe6a545.js";import"./p-1fd43aa6.js";import"./p-795f7c81.js";import"./p-29040467.js";import"./p-0e94eaa4.js";import"./p-33c0f331.js";import"./p-9f1a0adc.js";import"./p-5b0b1d68.js";import"./p-4f76b2d1.js";import"./p-2d1dac84.js";import"./p-42c332a2.js";import"./p-38e70926.js";import"./p-74887bd8.js";import"./p-783b6965.js";import"./p-a3f0a5f3.js";import"./p-e6a64715.js";import"./p-dc29c329.js";import"./p-6ffbaa7a.js";import"./p-fc9cd10b.js";import"./p-fdc41b20.js";import"./p-ecc7ed03.js";import"./p-05938a61.js";import"./p-8043ab9b.js";import"./p-faf4e331.js";import"./p-cd4a8b9a.js";import"./p-cae2235f.js";import"./p-9a4094ba.js";import"./p-1184cc61.js";import"./p-98e621d1.js";import"./p-1b31d781.js";import"./p-f7f8e6f9.js";import"./p-a779e49b.js";import"./p-7572c366.js";import"./p-832f907c.js";import"./p-5abe9c67.js";import"./p-0856fe30.js";import"./p-a5e3ec2a.js";import"./p-80be55a5.js";import"./p-b88ddb1e.js";import"./p-8dc3148c.js";import"./p-ca5fb53c.js";import"./p-d7fc78fa.js";import"./p-581eca80.js";import"./p-2a2efb66.js";import"./p-1701e549.js";import"./p-07a1e707.js";import"./p-8bc47c76.js";import"./p-c19b935f.js";import"./p-c8e3775b.js";import"./p-e75aa2b5.js";import"./p-f5f26b1f.js";import"./p-52a9dec5.js";import"./p-a379c2ce.js";import"./p-ae4c1e05.js";import"./p-a3e88624.js";import"./p-b6ec07fb.js";import"./p-b3dc802f.js";import"./p-db174923.js";import"./p-8eafbd05.js";import"./p-399020b7.js";import"./p-50b034e8.js";import"./p-6bb7b693.js";import"./p-de65627f.js";import"./p-791e5c7c.js";import"./p-015ba93b.js";import"./p-58405edc.js";import"./p-b4b7d6a0.js";import"./p-89e4900b.js";import"./p-8eb5caaf.js";import"./p-c6ce33a2.js";import"./p-fb79aaf0.js";import"./p-5977fcaf.js";import"./p-873e8cec.js";import"./p-21ae9bf7.js";import"./p-2a6d626a.js";import"./p-0357efed.js";import"./p-2f568dc7.js";import"./p-623dbe5e.js";const d="sublayers",b="layerView",l=Object.freeze({remove(){},pause(){},resume(){}});let u=class extends(j(h)){constructor(){super(...arguments),this._highlightIds=new Map,this.container=new c}async fetchPopupFeatures(t){return Array.from(this.graphicsViews(),(s=>s.hitTest(t).filter((t=>!!t.popupTemplate)))).flat()}*graphicsViews(){null==this._graphicsViewsFeatureCollectionMap?null==this._graphicsViews?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(t,s){return Array.from(this.graphicsViews(),(s=>{const p=s.hitTest(t);if(null!=this._graphicsViewsFeatureCollectionMap){const t=this._graphicsViewsFeatureCollectionMap.get(s);for(const s of p)!s.popupTemplate&&t.popupTemplate&&(s.popupTemplate=t.popupTemplate),s.sourceLayer=s.layer=this.layer}return p})).flat().map((s=>({type:"graphic",graphic:s,layer:this.layer,mapPoint:t})))}highlight(i){let r;"number"==typeof i?r=[i]:i instanceof t?r=[i.uid]:Array.isArray(i)&&i.length>0?r="number"==typeof i[0]?i:i.map((t=>t&&t.uid)):s.isCollection(i)&&(r=i.map((t=>t&&t.uid)).toArray());const o=r?.filter(p);return o?.length?(this._addHighlight(o),{remove:()=>{this._removeHighlight(o)}}):l}update(t){for(const s of this.graphicsViews())s.processUpdate(t)}attach(){const t=this.view,s=()=>this.requestUpdate(),p=this.layer.featureCollections;if(null!=p&&p.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const o of p){const p=new f(this.view.featuresTilingScheme),e=new n({view:t,graphics:o.source,renderer:o.renderer,requestUpdateCallback:s,container:p});this._graphicsViewsFeatureCollectionMap.set(e,o),this.container.addChild(e.container),this.addHandles([i((()=>o.visible),(t=>e.container.visible=t),r),i((()=>e.updating),(()=>this.notifyChange("updating")),r)],b)}this._updateHighlight()}else null!=this.layer.sublayers&&this.addHandles(o((()=>this.layer.sublayers),"change",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),d)}detach(){this._destroyGraphicsViews(),this.removeHandles(d)}moveStart(){}moveEnd(){}viewChange(){for(const t of this.graphicsViews())t.viewChange()}isUpdating(){for(const t of this.graphicsViews())if(t.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(b);for(const t of this.graphicsViews())t.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),null==this.layer.sublayers)return;const t=[],s=this.view,p=()=>this.requestUpdate();for(const o of this.layer.sublayers){const e=new m,a=new f(this.view.featuresTilingScheme);a.fadeTransitionEnabled=!0;const c=new n({view:s,graphics:o.graphics,requestUpdateCallback:p,container:a});this.addHandles([o.on("graphic-update",c.graphicUpdateHandler),i((()=>o.visible),(t=>c.container.visible=t),r),i((()=>c.updating),(()=>this.notifyChange("updating")),r)],b),e.addChild(c.container),this.container.addChild(e),t.push(c)}this._graphicsViews=t,this._updateHighlight()}_addHighlight(t){for(const s of t)if(this._highlightIds.has(s)){const t=this._highlightIds.get(s);this._highlightIds.set(s,t+1)}else this._highlightIds.set(s,1);this._updateHighlight()}_removeHighlight(t){for(const s of t)if(this._highlightIds.has(s)){const t=this._highlightIds.get(s)-1;0===t?this._highlightIds.delete(s):this._highlightIds.set(s,t)}this._updateHighlight()}_updateHighlight(){const t=Array.from(this._highlightIds.keys());for(const s of this.graphicsViews())s.setHighlight(t)}};u=e([a("esri.views.2d.layers.MapNotesLayerView2D")],u);const g=u;export default g;
//# sourceMappingURL=p-b596e2a7.js.map