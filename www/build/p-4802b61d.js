import{l as t,y as s,bm as e,n as i,ad as p,s as r,fb as o,N as a}from"./p-b54724b6.js";import n from"./p-7dd25b16.js";import{e as m}from"./p-015ba93b.js";import"./p-843f0c78.js";import"./p-07f12c16.js";import"./p-570a8a46.js";import"./p-13e550f5.js";import"./p-49f0006c.js";import"./p-541ec65c.js";import"./p-5f5f43c2.js";import"./p-6ffbaa7a.js";import"./p-fc9cd10b.js";import"./p-fdc41b20.js";import"./p-ecc7ed03.js";import"./p-05938a61.js";import"./p-8043ab9b.js";import"./p-faf4e331.js";import"./p-74887bd8.js";import"./p-cd4a8b9a.js";import"./p-cae2235f.js";import"./p-9a4094ba.js";import"./p-9f1a0adc.js";import"./p-1184cc61.js";import"./p-98e621d1.js";import"./p-1b31d781.js";import"./p-f7f8e6f9.js";import"./p-a779e49b.js";import"./p-7572c366.js";import"./p-832f907c.js";import"./p-5abe9c67.js";import"./p-0856fe30.js";import"./p-a5e3ec2a.js";import"./p-80be55a5.js";import"./p-b88ddb1e.js";import"./p-8dc3148c.js";import"./p-ca5fb53c.js";import"./p-e6a64715.js";import"./p-dc29c329.js";import"./p-d7fc78fa.js";import"./p-a3f0a5f3.js";import"./p-581eca80.js";import"./p-2a2efb66.js";import"./p-1701e549.js";import"./p-07a1e707.js";import"./p-8bc47c76.js";import"./p-c19b935f.js";import"./p-c8e3775b.js";import"./p-e75aa2b5.js";import"./p-f5f26b1f.js";import"./p-783b6965.js";import"./p-52a9dec5.js";import"./p-2d1dac84.js";import"./p-a379c2ce.js";import"./p-b6ec07fb.js";import"./p-b3dc802f.js";import"./p-29040467.js";import"./p-0e94eaa4.js";import"./p-795f7c81.js";import"./p-0fe6a545.js";import"./p-1fd43aa6.js";import"./p-33c0f331.js";import"./p-5b0b1d68.js";import"./p-4f76b2d1.js";import"./p-42c332a2.js";import"./p-38e70926.js";import"./p-db174923.js";import"./p-8eafbd05.js";import"./p-399020b7.js";import"./p-50b034e8.js";import"./p-6bb7b693.js";import"./p-de65627f.js";import"./p-791e5c7c.js";import"./p-a25d6f7d.js";import"./p-cc8b27b8.js";import"./p-58405edc.js";import"./p-30bab7e4.js";import"./p-505c1a4d.js";import"./p-a3e88624.js";import"./p-6b09cddc.js";import"./p-52324761.js";import"./p-3faf3e32.js";const c=p=>{let r=class extends p{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}constructor(...t){super(...t),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return this._isUserPaused?"paused":this._streamConnectionStatus}_onSuspendedChange(t){t?this._doPause():this._isUserPaused||this._doResume()}};return t([s()],r.prototype,"_isUserPaused",void 0),t([s({readOnly:!0})],r.prototype,"connectionStatus",null),t([s({type:e})],r.prototype,"filter",void 0),r=t([i("esri.layers.mixins.StreamLayerView")],r),r};function j(t,s){if(null==t&&null==s)return null;const e={};return null!=s&&(e.geometry=s.toJSON()),null!=t&&(e.where=t),e}let d=class extends(c(n)){constructor(){super(...arguments),this.pipelineConnectionStatus="disconnected",this.pipelineErrorString=null,this._enabledEventTypes=new Set}initialize(){this.addHandles([p((()=>this.layer.customParameters),(t=>this._proxy.updateCustomParameters(t))),this.layer.on("send-message-to-socket",(t=>this._proxy.sendMessageToSocket(t))),this.layer.on("send-message-to-client",(t=>this._proxy.sendMessageToClient(t))),p((()=>this.layer.purgeOptions),(()=>this._update())),p((()=>this.suspended),this._onSuspendedChange.bind(this))],"constructor")}get connectionError(){return this.pipelineErrorString?new r("stream-controller",this.pipelineErrorString):null}on(t,s){if(Array.isArray(t))return o(t.map((t=>this.on(t,s))));const e=["data-received","message-received"].includes(t);e&&(this._enabledEventTypes.add(t),this._proxy.enableEvent(t,!0));const i=super.on(t,s),p=this;return{remove(){i.remove(),e&&(p._proxy.closed||p.hasEventListener(t)||p._proxy.enableEvent(t,!1))}}}queryLatestObservations(t,s){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new r("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(t),s).then((t=>{const s=a.fromJSON(t);return s.features.forEach((t=>{t.layer=this.layer,t.sourceLayer=this.layer})),s}))}detach(){super.detach(),this.pipelineConnectionStatus="disconnected"}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){this._proxy?.pauseStream()}_doResume(){this._proxy?.resumeStream()}_createClientOptions(){return{...super._createClientOptions(),setProperty:t=>{this.set(t.propertyName,t.value)}}}_createTileRendererHash(t){const s=`${JSON.stringify(this.layer.purgeOptions)}.${JSON.stringify(j(this.layer.definitionExpression,this.layer.geometryDefinition))})`;return super._createTileRendererHash(t)+s}async _createServiceOptions(){const t=this.layer,{objectIdField:s}=t,e=t.fields.map((t=>t.toJSON())),i=m(t.geometryType),p=t.timeInfo&&t.timeInfo.toJSON()||null,r=t.spatialReference?t.spatialReference.toJSON():null;return{type:"stream",isPaused:this._isUserPaused,fields:e,geometryType:i,objectIdField:s,timeInfo:p,source:this.layer.parsedUrl,serviceFilter:j(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enabledEventTypes:Array.from(this._enabledEventTypes.values()),spatialReference:r,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval,customParameters:t.customParameters}}};t([s()],d.prototype,"pipelineConnectionStatus",void 0),t([s()],d.prototype,"pipelineErrorString",void 0),t([s({readOnly:!0})],d.prototype,"connectionError",null),t([s({readOnly:!0})],d.prototype,"_streamConnectionStatus",null),d=t([i("esri.views.2d.layers.StreamLayerView2D")],d);const h=d;export default h;
//# sourceMappingURL=p-4802b61d.js.map