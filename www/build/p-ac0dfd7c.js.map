{"version":3,"names":["async","m","n","s","p","t","o","r","from","then","count","data","extent","e","fromJSON","F","constructor","super","this","dynamicDataSource","fieldsIndex","gdbVersion","infoFor3D","pbfSupported","queryAttachmentsSupported","sourceSpatialReference","url","parsedUrl","executeJSON","featureSetFromJSON","_normalizeQuery","outStatistics","has","i","u","f","a","name","d","_normalizeFields","fields","_queryIs3DObjectFormat","features","h","meshFeatureSetFromJSON","import","b","executeForCount","l","executeForExtent","executeForIds","y","default","executeRelationshipQuery","Promise","all","kd","clone","executeRelationshipQueryForCount","executeAttachmentQuery","fetchAttachments","processAttachmentQueryResult","executeTopFeaturesQuery","executeForTopIds","executeForTopExtents","executeForTopCount","S","c","formatOf3DObjects","supportedFormats","queryFormats","outFields","includes","originX","originY","originZ","translationX","translationY","translationZ","scaleX","scaleY","scaleZ","rotationX","rotationY","rotationZ","rotationDeg","transformFieldRoles","push","get","Object","assign","toJSON","returnGeometry","multipatchOption","type","prototype","readOnly","String","x"],"sources":["./node_modules/@arcgis/core/rest/query/executeForExtent.js","./node_modules/@arcgis/core/layers/graphics/sources/support/QueryTask.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{parseUrl as t}from\"../utils.js\";import{executeQueryForExtent as o}from\"./operations/query.js\";import r from\"../support/Query.js\";import e from\"../../geometry/Extent.js\";async function m(m,n,s){const p=t(m);return o(p,r.from(n),{...s}).then((t=>({count:t.data.count,extent:e.fromJSON(t.data.extent)})))}export{m as executeForExtent};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import r from\"../../../../core/Error.js\";import has from\"../../../../core/has.js\";import{whenOrAbort as o}from\"../../../../core/promiseUtils.js\";import{urlToObject as s}from\"../../../../core/urlUtils.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import{subclass as u}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getMimeTypeFormatId as a,getFilenameFormatId as n}from\"../../../support/infoFor3D.js\";import{DataLayerSource as c}from\"../../../support/source/DataLayerSource.js\";import{parseUrl as p}from\"../../../../rest/utils.js\";import{executeForCount as l}from\"../../../../rest/query/executeForCount.js\";import{executeForExtent as m}from\"../../../../rest/query/executeForExtent.js\";import{executeForIds as y}from\"../../../../rest/query/executeForIds.js\";import{executeRawQueryJSON as d}from\"../../../../rest/query/executeQueryJSON.js\";import{executeRawQueryPBF as f}from\"../../../../rest/query/executeQueryPBF.js\";import h from\"../../../../rest/support/FeatureSet.js\";import S from\"../../../../rest/support/Query.js\";let F=class extends t{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return s(this.url)}async execute(e,t){const r=await this.executeJSON(e,t);return this.featureSetFromJSON(e,r,t)}async executeJSON(e,t){const r=this._normalizeQuery(e),o=null!=e.outStatistics?.[0],s=has(\"featurelayer-pbf-statistics\"),i=!o||s;let u;if(this.pbfSupported&&i)try{u=await f(this.url,r,t)}catch(a){if(\"query:parsing-pbf\"!==a.name)throw a;this.pbfSupported=!1}return this.pbfSupported&&i||(u=await d(this.url,r,t)),this._normalizeFields(u.fields),u}async featureSetFromJSON(e,t,r){if(!this._queryIs3DObjectFormat(e)||null==this.infoFor3D||!t.features)return h.fromJSON(t);const{meshFeatureSetFromJSON:s}=await o(import(\"../../../../rest/support/meshFeatureSet.js\"),r);return s(e,this.infoFor3D,t)}executeForCount(e,t){return l(this.url,this._normalizeQuery(e),t)}executeForExtent(e,t){return m(this.url,this._normalizeQuery(e),t)}executeForIds(e,t){return y(this.url,this._normalizeQuery(e),t)}async executeRelationshipQuery(e,t){const[{default:r},{executeRelationshipQuery:s}]=await o(Promise.all([import(\"../../../../rest/support/RelationshipQuery.js\"),import(\"../../../../rest/query/executeRelationshipQuery.js\")]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)}async executeRelationshipQueryForCount(e,t){const[{default:r},{executeRelationshipQueryForCount:s}]=await o(Promise.all([import(\"../../../../rest/support/RelationshipQuery.js\"),import(\"../../../../rest/query/executeRelationshipQuery.js\")]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)}async executeAttachmentQuery(e,t){const{executeAttachmentQuery:r,fetchAttachments:s,processAttachmentQueryResult:i}=await o(import(\"../../../../rest/query/operations/queryAttachments.js\"),t),u=p(this.url);return i(u,await(this.queryAttachmentsSupported?r(u,e,t):s(u,e,t)))}async executeTopFeaturesQuery(e,t){const{executeTopFeaturesQuery:r}=await o(import(\"../../../../rest/query/executeTopFeaturesQuery.js\"),t);return r(this.parsedUrl,e,this.sourceSpatialReference,t)}async executeForTopIds(e,t){const{executeForTopIds:r}=await o(import(\"../../../../rest/query/executeForTopIds.js\"),t);return r(this.parsedUrl,e,t)}async executeForTopExtents(e,t){const{executeForTopExtents:r}=await o(import(\"../../../../rest/query/executeForTopExtents.js\"),t);return r(this.parsedUrl,e,t)}async executeForTopCount(e,t){const{executeForTopCount:r}=await o(import(\"../../../../rest/query/executeForTopCount.js\"),t);return r(this.parsedUrl,e,t)}_normalizeQuery(e){let t=S.from(e);t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?c.from(e.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:o}=this;if(null!=o&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;const{supportedFormats:s,queryFormats:i}=o,u=a(\"model/gltf-binary\",s)??n(\"glb\",s),c=a(\"model/gltf+json\",s)??n(\"gtlf\",s);for(const e of i){if(e===u){t.formatOf3DObjects=e;break}e!==c||t.formatOf3DObjects||(t.formatOf3DObjects=e)}if(!t.formatOf3DObjects)throw new r(\"query:unsupported-3d-query-formats\",\"Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf\");if(null==t.outFields||!t.outFields.includes(\"*\")){t=t===e?t.clone():t,null==t.outFields&&(t.outFields=[]);const{originX:r,originY:s,originZ:i,translationX:u,translationY:a,translationZ:n,scaleX:c,scaleY:p,scaleZ:l,rotationX:m,rotationY:y,rotationZ:d,rotationDeg:f}=o.transformFieldRoles;t.outFields.push(r,s,i,u,a,n,c,p,l,m,y,d,f)}}return t}_normalizeFields(e){if(null!=this.fieldsIndex&&null!=e)for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(e){return null!=this.infoFor3D&&!0===e.returnGeometry&&\"xyFootprint\"!==e.multipatchOption&&!e.outStatistics}};e([i({type:c})],F.prototype,\"dynamicDataSource\",void 0),e([i()],F.prototype,\"fieldsIndex\",void 0),e([i()],F.prototype,\"gdbVersion\",void 0),e([i()],F.prototype,\"infoFor3D\",void 0),e([i({readOnly:!0})],F.prototype,\"parsedUrl\",null),e([i()],F.prototype,\"pbfSupported\",void 0),e([i()],F.prototype,\"queryAttachmentsSupported\",void 0),e([i()],F.prototype,\"sourceSpatialReference\",void 0),e([i({type:String})],F.prototype,\"url\",void 0),F=e([u(\"esri.tasks.QueryTask\")],F);const x=F;export{x as default};\n"],"mappings":"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"}