import{hs as o,aU as e,e as n,U as s,cv as t,cF as r,c as i,dL as c,dY as a,ht as y,dV as f,N as l,t as m,hp as u}from"./p-b54724b6.js";const p={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function G(o){const e=o.folders||[],n=e.slice(),t=new Map,r=new Map,i=new Map,c=new Map,a=new Map,y={esriGeometryPoint:r,esriGeometryPolyline:i,esriGeometryPolygon:c};(o.featureCollection&&o.featureCollection.layers||[]).forEach((o=>{const e=s(o);e.featureSet.features=[];const n=o.featureSet.geometryType;t.set(n,e);const a=o.layerDefinition.objectIdField;"esriGeometryPoint"===n?w(r,a,o.featureSet.features):"esriGeometryPolyline"===n?w(i,a,o.featureSet.features):"esriGeometryPolygon"===n&&w(c,a,o.featureSet.features)})),o.groundOverlays&&o.groundOverlays.forEach((o=>{a.set(o.id,o)})),e.forEach((e=>{e.networkLinkIds.forEach((s=>{const t=x(s,e.id,o.networkLinks);t&&n.push(t)}))})),n.forEach((o=>{if(o.featureInfos){o.points=s(t.get("esriGeometryPoint")),o.polylines=s(t.get("esriGeometryPolyline")),o.polygons=s(t.get("esriGeometryPolygon")),o.mapImages=[];for(const e of o.featureInfos)switch(e.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const n=y[e.type].get(e.id);n&&o[p[e.type]]?.featureSet.features.push(n);break}case"GroundOverlay":{const n=a.get(e.id);n&&o.mapImages.push(n);break}}o.fullExtent=h([o])}}));const f=h(n);return{folders:e,sublayers:n,extent:f}}function P(o,e,s,c){const a=t&&t.findCredential(o);o=r(o,{token:a&&a.token});const y=i.kmlServiceUrl;return n(y,{query:{url:o,model:"simple",folders:"",refresh:0!==s||void 0,outSR:JSON.stringify(e)},responseType:"json",signal:c})}function d(o,e,n=null,s=[]){const t=[],r={},i=e.sublayers,c=e.folders.map((o=>o.id));return i.forEach((e=>{const i=new o;if(n?i.read(e,n):i.read(e),s.length&&c.includes(i.id)&&(i.visible=s.includes(i.id)),r[e.id]=i,null!=e.parentFolderId&&-1!==e.parentFolderId){const o=r[e.parentFolderId];o.sublayers||(o.sublayers=[]),o.sublayers?.unshift(i)}else t.unshift(i)})),t}function w(o,e,n){n.forEach((n=>{o.set(n.attributes[e],n)}))}function g(o,e){let n;return e.some((e=>e.id===o&&(n=e,!0))),n}function x(o,e,n){const s=g(o,n);return s&&(s.parentFolderId=e,s.networkLink=s),s}async function b(o){const e=l.fromJSON(o.featureSet).features,n=o.layerDefinition,s=m(n.drawingInfo.renderer),t=u.fromJSON(o.popupInfo),r=[];for(const o of e){const e=await s.getSymbolAsync(o);o.symbol=e,o.popupTemplate=t,o.visible=!0,r.push(o)}return r}function h(n){const s=c(a),t=c(a);for(const o of n){if(o.polygons&&o.polygons.featureSet&&o.polygons.featureSet.features)for(const e of o.polygons.featureSet.features)y(s,e.geometry),f(t,s);if(o.polylines&&o.polylines.featureSet&&o.polylines.featureSet.features)for(const e of o.polylines.featureSet.features)y(s,e.geometry),f(t,s);if(o.points&&o.points.featureSet&&o.points.featureSet.features)for(const e of o.points.featureSet.features)y(s,e.geometry),f(t,s);if(o.mapImages)for(const e of o.mapImages)y(s,e.extent),f(t,s)}return o(t,a)?void 0:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:e.WGS84}}export{d as S,b,G as d,P as g,h as j};
//# sourceMappingURL=p-d19bdf9e.js.map