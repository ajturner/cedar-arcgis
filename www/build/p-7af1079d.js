import{cs as n,e as t,cr as r,cc as e,bP as o}from"./p-b54724b6.js";import{b as u}from"./p-a5e3ec2a.js";import{t as s}from"./p-b88ddb1e.js";const l="Layer does not support extent calculation.";function c(n,t){const r=n.geometry,o=n.toJSON(),u=o;if(null!=r&&(u.geometry=JSON.stringify(r),u.geometryType=e(r),u.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),o.topFilter?.groupByFields&&(u.topFilter.groupByFields=o.topFilter.groupByFields.join(",")),o.topFilter?.orderByFields&&(u.topFilter.orderByFields=o.topFilter.orderByFields.join(",")),o.topFilter&&(u.topFilter=JSON.stringify(u.topFilter)),o.objectIds&&(u.objectIds=o.objectIds.join(",")),o.orderByFields&&(u.orderByFields=o.orderByFields.join(",")),o.outFields&&!(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?o.outFields.includes("*")?u.outFields="*":u.outFields=o.outFields.join(","):delete u.outFields,o.outSR?u.outSR=o.outSR.wkid||JSON.stringify(o.outSR):r&&o.returnGeometry&&(u.outSR=u.inSR),o.returnGeometry&&delete o.returnGeometry,o.timeExtent){const n=o.timeExtent,{start:t,end:r}=n;null==t&&null==r||(u.time=t===r?t:`${t??"null"},${r??"null"}`),delete o.timeExtent}return u}async function a(t,r,e,o){const u=await y(t,r,"json",o);return n(r,e,u.data),u}async function f(n,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:y(n,t,"json",r,{returnIdsOnly:!0})}async function i(n,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:y(n,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((n=>{const t=n.data;if(t.hasOwnProperty("extent"))return n;if(t.features)throw new Error(l);if(t.hasOwnProperty("count"))throw new Error(l);return n}))}function d(n,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):y(n,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function y(n,e,l,a={},f={}){const i="string"==typeof n?o(n):n,d=e.geometry?[e.geometry]:[];return a.responseType="pbf"===l?"array-buffer":"json",u(d,null,a).then((n=>{const o=n&&n[0];null!=o&&((e=e.clone()).geometry=o);const u=s({...i.query,f:l,...f,...c(e,f)});return t(r(i.path,"queryTopFeatures"),{...a,query:{...u,...a.query}})}))}export{f as d,d as m,i as p,a as y};
//# sourceMappingURL=p-7af1079d.js.map