import{dH as n,dM as t,R as r,cL as e,a_ as s,aR as u,dN as o,dG as i,dI as l}from"./p-b54724b6.js";import{t as c}from"./p-c6ce33a2.js";function f(n,t){return n?t?4:3:t?3:2}function a(n,t,r,e,s){if(null==t||!t.lengths.length)return null;const u="upperLeft"===s?.originPosition?-1:1;n.lengths.length&&(n.lengths.length=0),n.coords.length&&(n.coords.length=0);const o=n.coords,i=[],l=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:a}=t,p=f(r,e);let b=0;for(const n of c){const t=h(l,a,b,n,r,e,u);t&&i.push(t),b+=n*p}if(i.sort(((n,t)=>{let e=u*n[2]-u*t[2];return 0===e&&r&&(e=n[4]-t[4]),e})),i.length){let n=6*i[0][2];o[0]=i[0][0]/n,o[1]=i[0][1]/n,r&&(n=6*i[0][4],o[2]=0!==n?i[0][3]/n:0),(o[0]<l[0]||o[0]>l[1]||o[1]<l[2]||o[1]>l[3]||r&&(o[2]<l[4]||o[2]>l[5]))&&(o.length=0)}if(!o.length){const n=t.lengths[0]?m(a,0,c[0],r,e):null;if(!n)return null;o[0]=n[0],o[1]=n[1],r&&n.length>2&&(o[2]=n[2])}return n}function h(n,t,r,e,s,u,o=1){const i=f(s,u);let l=r,c=r+i,a=0,h=0,m=0,p=0,b=0;for(let r=0,u=e-1;r<u;r++,l+=i,c+=i){const r=t[l],e=t[l+1],u=t[l+2],o=t[c],i=t[c+1],f=t[c+2];let N=r*i-o*e;p+=N,a+=(r+o)*N,h+=(e+i)*N,s&&(N=r*f-o*u,m+=(u+f)*N,b+=N),r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r),e<n[2]&&(n[2]=e),e>n[3]&&(n[3]=e),s&&(u<n[4]&&(n[4]=u),u>n[5]&&(n[5]=u))}if(p*o>0&&(p*=-1),b*o>0&&(b*=-1),!p)return null;const N=[a,h,.5*p];return s&&(N[3]=m,N[4]=.5*b),N}function m(n,t,r,e,s){const u=f(e,s);let o=t,i=t+u,l=0,c=0,a=0,h=0;for(let t=0,s=r-1;t<s;t++,o+=u,i+=u){const t=n[o],r=n[o+1],s=n[o+2],u=n[i],f=n[i+1],m=n[i+2],d=e?b(t,r,s,u,f,m):p(t,r,u,f);if(d)if(l+=d,e){const n=x(t,r,s,u,f,m);c+=d*n[0],a+=d*n[1],h+=d*n[2]}else{const n=N(t,r,u,f);c+=d*n[0],a+=d*n[1]}}return l>0?e?[c/l,a/l,h/l]:[c/l,a/l]:r>0?e?[n[t],n[t+1],n[t+2]]:[n[t],n[t+1]]:null}function p(n,t,r,e){const s=r-n,u=e-t;return Math.sqrt(s*s+u*u)}function b(n,t,r,e,s,u){const o=e-n,i=s-t,l=u-r;return Math.sqrt(o*o+i*i+l*l)}function N(n,t,r,e){return[n+.5*(r-n),t+.5*(e-t)]}function x(n,t,r,e,s,u){return[n+.5*(e-n),t+.5*(s-t),r+.5*(u-r)]}const d=[0,0];function y(n,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=n(t.x,t.y,d),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=n(t.xmin,t.ymin,d),[r.xmax,r.ymax]=n(t.xmax,t.ymax,d),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:M(t.rings,n),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:M(t.paths,n),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:g(t.points,n),hasM:t.hasM,hasZ:t.hasZ}:null}function M(n,t){const r=[];for(const e of n)r.push(g(e,t));return r}function g(n,t){const r=[];for(const e of n){const n=t(e[0],e[1],[0,0]);r.push(n),e.length>2&&n.push(e[2]),e.length>3&&n.push(e[3])}return r}async function R(n,t){if(!n||!t)return;const s=Array.isArray(n)?n.map((n=>null!=n.geometry?n.geometry.spatialReference:null)).filter(r):[n];await e(s.map((n=>({source:n,dest:t}))))}const S=y.bind(null,n),w=y.bind(null,t);function Z(n,t,r,e){if(!n)return n;if(r||(r=t,t=n.spatialReference),!s(t)||!s(r)||u(t,r))return n;if(o(t,r)){const t=i(r)?S(n):w(n);return t.spatialReference=r,t}return l(c,[n],t,r,null,e)[0]}class j{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(n,t,r){if(!n||!n.length||!t||!r||u(t,r))return n;const e={geometries:n,inSpatialReference:t,outSpatialReference:r,resolve:null};return this._jobs.push(e),new Promise((n=>{e.resolve=n,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:t,inSpatialReference:r,outSpatialReference:e,resolve:s}=n;o(r,e)?i(e)?s(t.map(S)):s(t.map(w)):s(l(c,t,r,e,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const v=new j;function L(n,t,r){return v.push(n,t,r)}export{L as M,R as f,Z as g,a as t};
//# sourceMappingURL=p-8eb5caaf.js.map