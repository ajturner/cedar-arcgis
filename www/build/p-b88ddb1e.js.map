{"version":3,"names":["t","n","o","e","r","Array","isArray","length","toJSON","JSON","stringify","l","s","type","xmin","ymin","xmax","ymax","x","y","spatialReference","geometry","i","compactGeometryEnabled","defaultSpatialReferenceEnabled","a","u","wkid","geometryType","inSR","groupByFieldsForStatistics","join","objectIds","orderByFields","outFields","returnDistinctValues","returnCountOnly","returnExtentOnly","returnIdsOnly","includes","outSR","outSpatialReference","returnGeometry","returnCentroid","outStatistics","fullText","pixelSize","quantizationParameters","extent","equals","parameterValues","rangeValues","dynamicDataSource","layer","source","timeExtent","start","end","time","defaultSR","async","m","isEmpty","data","features","c","createFeatureResult","f","d","Promise","resolve","p","count","S","hasOwnProperty","Error","responseType","clone","query","path","E","formatOf3DObjects"],"sources":["./node_modules/@arcgis/core/rest/operations/urlUtils.js","./node_modules/@arcgis/core/rest/query/operations/query.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{urlToObject as e,join as n}from\"../../../core/urlUtils.js\";import{getJsonType as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{mapParameters as a}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as o}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as u}from\"./queryZScale.js\";const l=\"Layer does not support extent calculation.\";function s(t,e){if(e&&\"extent\"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&\"point\"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}function y(t,e){const n=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const a=i;let o,u,l;if(null!=n&&(u=n.spatialReference,l=n.spatialReference.wkid||JSON.stringify(n.spatialReference),a.geometryType=r(n),a.geometry=s(n,t.compactGeometryEnabled),a.inSR=l),i.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(\",\")),i.objectIds&&(a.objectIds=i.objectIds.join(\",\")),i.orderByFields&&(a.orderByFields=i.orderByFields.join(\",\")),!i.outFields||!i.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete a.outFields:i.outFields.includes(\"*\")?a.outFields=\"*\":a.outFields=i.outFields.join(\",\"),i.outSR?(a.outSR=i.outSR.wkid||JSON.stringify(i.outSR),o=t.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(a.outSR=a.inSR,o=u),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(a.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(a.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(a.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=u&&null!=t.quantizationParameters&&null!=t.quantizationParameters.extent&&u.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(a.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(a.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(a.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const t=i.timeExtent,{start:e,end:n}=t;null==e&&null==n||(a.time=e===n?e:`${e??\"null\"},${n??\"null\"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=u&&null!=o&&u.equals(o)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}async function m(t,e,n,r){const i=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await x(t,e,\"json\",r);return u(e,n,i.data),i}async function c(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await f(t,e,r),a=i;return a.data=o(i.data,n),a}function f(t,e,n){return x(t,e,\"pbf\",n)}function d(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):x(t,e,\"json\",n,{returnIdsOnly:!0})}function p(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):x(t,e,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}async function S(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await x(t,e,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(\"extent\"))return r;if(i.features)throw new Error(l);if(i.hasOwnProperty(\"count\"))throw new Error(l);return r}async function x(r,o,u,l={},s={}){const m=\"string\"==typeof r?e(r):r,c=o.geometry?[o.geometry]:[];l.responseType=\"pbf\"===u?\"array-buffer\":\"json\";const f=await i(c,null,l),d=f&&f[0];null!=d&&((o=o.clone()).geometry=d);const p=a({...m.query,f:u,...s,...y(o,s)});return t(n(m.path,E(o,s)?\"query3d\":\"query\"),{...l,query:{...p,...l.query}})}function E(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}export{s as encodeGeometry,m as executeQuery,p as executeQueryForCount,S as executeQueryForExtent,d as executeQueryForIds,c as executeQueryPBF,f as executeQueryPBFBuffer,y as queryToQueryStringParameters,x as runQuery};\n"],"mappings":"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"}