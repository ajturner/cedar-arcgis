import { bT as L, l as a, cx as r$1, q as s$1, n, cy as v$1, c as j$1, al as p, cz as G, k as s$2, cA as m$1, bi as j$2, s as s$3, cB as R$1, bd as d$1, bq as d$2 } from './interfaces-f9f0dded.js';
import { o as o$3, s as s$4, i as i$1, r as r$2 } from './normalizeUtilsCommon-b073ef53.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
function i(r,t){return t?{...t,query:{...r??{},...t.query}}:{query:r}}function f(r){return "string"==typeof r?L(r):a(r)}function s(r,t,o){const e={};for(const n in r){if("declaredClass"===n)continue;const i=r[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){e[n]=[];for(let r=0;r<i.length;r++)e[n][r]=s(i[r]);}else if("object"==typeof i)if(i.toJSON){const r=i.toJSON(o&&o[n]);e[n]=t?r:JSON.stringify(r);}else e[n]=t?i:JSON.stringify(i);else e[n]=i;}return e}function l(o,e){return o?r$1(o)&&(e||s$1.apiKey)?e||s$1.apiKey:n?.findCredential(o)?.token:null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
async function o$2(o,i,n,m){const a=f(o),p$1=i[0].spatialReference,u={...m,query:{...a.query,f:"json",sr:JSON.stringify(p$1),target:JSON.stringify({geometryType:v$1(i[0]),geometries:i}),cutter:JSON.stringify(n)}},c=await j$1(a.path+"/cut",u),{cutIndexes:f$1,geometries:g=[]}=c.data;return {cutIndexes:f$1,geometries:g.map((e=>{const t=p(e);return t.spatialReference=p$1,t}))}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
function r(t){return {geometryType:v$1(t[0]),geometries:t.map((e=>e.toJSON()))}}function o$1(e,r,o){const n=G(r);return e.map((e=>{const t=n.fromJSON(e);return t.spatialReference=o,t}))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
async function o(o,m,f){const n="string"==typeof o?L(o):o,p=m[0].spatialReference,a=v$1(m[0]),u={...f,query:{...n.query,f:"json",sr:p.wkid??JSON.stringify(p),geometries:JSON.stringify(r(m))}},{data:y}=await j$1(n.path+"/simplify",u);return o$1(y.geometries,a,p)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
const m=s$2.getLogger("esri.geometry.support.normalizeUtils");function g(e){return "polygon"===e.type}function y(e){return "polygon"===e[0].type}function x(e){return "polyline"===e[0].type}function d(e){const t=[];let n=0,o=0;for(let s=0;s<e.length;s++){const r=e[s];let i=null;for(let e=0;e<r.length;e++)i=r[e],t.push(i),0===e?(n=i[0],o=n):(n=Math.min(n,i[0]),o=Math.max(o,i[0]));i&&t.push([(n+o)/2,0]);}return t}function w(e,n){if(!(e instanceof m$1||e instanceof j$2)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw m.error(e),new s$3(e)}const i=o$3(e),l=[];for(const t of i){const e=[];l.push(e),e.push([t[0][0],t[0][1]]);for(let o=0;o<t.length-1;o++){const s=t[o][0],r=t[o][1],i=t[o+1][0],l=t[o+1][1],f=Math.sqrt((i-s)*(i-s)+(l-r)*(l-r)),c=(l-r)/f,p=(i-s)/f,u=f/n;if(u>1){for(let l=1;l<=u-1;l++){const t=l*n,o=p*t+s,i=c*t+r;e.push([o,i]);}const t=(f+Math.floor(u-1)*n)/2,o=p*t+s,i=c*t+r;e.push([o,i]);}e.push([i,l]);}}return g(e)?new j$2({rings:l,spatialReference:e.spatialReference}):new m$1({paths:l,spatialReference:e.spatialReference})}function j(e,t,n){if(t){const t=w(e,1e6);e=R$1(t,!0);}return n&&(e=s$4(e,n)),e}function M(e,t,n){if(Array.isArray(e)){const o=e[0];if(o>t){const n=i$1(o,t);e[0]=o+n*(-2*t);}else if(o<n){const t=i$1(o,n);e[0]=o+t*(-2*n);}}else {const o=e.x;if(o>t){const n=i$1(o,t);e=e.clone().offset(n*(-2*t),0);}else if(o<n){const t=i$1(o,n);e=e.clone().offset(t*(-2*n),0);}}return e}function R(e,t){let n=-1;for(let o=0;o<t.cutIndexes.length;o++){const s=t.cutIndexes[o],i=t.geometries[o],f=o$3(i);for(let e=0;e<f.length;e++){const t=f[e];t.some((n=>{if(n[0]<180)return !0;{let n=0;for(let e=0;e<t.length;e++){const o=t[e][0];n=o>n?o:n;}n=Number(n.toFixed(9));const o=-360*i$1(n,180);for(let s=0;s<t.length;s++){const t=i.getPoint(e,s);i.setPoint(e,s,t.clone().offset(o,0));}return !0}}));}if(s===n){if(y(e))for(const t of o$3(i))e[s]=e[s].addRing(t);else if(x(e))for(const t of o$3(i))e[s]=e[s].addPath(t);}else n=s,e[s]=i;}return e}async function b(t,n,r){if(!Array.isArray(t))return b([t],n);n&&"string"!=typeof n&&m.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const u="string"==typeof n?n:n?.url??s$1.geometryServiceUrl;let g,y,x,d,w,P,v,L,U=0;const z=[],A=[];for(const e of t)if(null!=e)if(g||(g=e.spatialReference,y=d$1(g),x=g.isWebMercator,P=x?102100:4326,d=r$2[P].maxX,w=r$2[P].minX,v=r$2[P].plus180Line,L=r$2[P].minus180Line),y)if("mesh"===e.type)A.push(e);else if("point"===e.type)A.push(M(e.clone(),d,w));else if("multipoint"===e.type){const t=e.clone();t.points=t.points.map((e=>M(e,d,w))),A.push(t);}else if("extent"===e.type){const t=e.clone()._normalize(!1,!1,y);A.push(t.rings?new j$2(t):t);}else if(e.extent){const t=e.extent,n=i$1(t.xmin,w)*(2*d);let o=0===n?e.clone():s$4(e.clone(),n);t.offset(n,0),t.intersects(v)&&t.xmax!==d?(U=t.xmax>U?t.xmax:U,o=j(o,x),z.push(o),A.push("cut")):t.intersects(L)&&t.xmin!==w?(U=t.xmax*(2*d)>U?t.xmax*(2*d):U,o=j(o,x,360),z.push(o),A.push("cut")):A.push(o);}else A.push(e.clone());else A.push(e);else A.push(e);let S=i$1(U,d),k=-90;const C=S,I=new m$1;for(;S>0;){const e=360*S-180;I.addPath([[e,k],[e,-1*k]]),k*=-1,S--;}if(z.length>0&&C>0){const e=R(z,await o$2(u,z,I,r)),n=[],o$1=[];for(let r=0;r<A.length;r++){const s=A[r];if("cut"!==s)o$1.push(s);else {const s=e.shift(),i=t[r];null!=i&&"polygon"===i.type&&i.rings&&i.rings.length>1&&s.rings.length>=i.rings.length?(n.push(s),o$1.push("simplify")):o$1.push(x?d$2(s):s);}}if(!n.length)return o$1;const s=await o(u,n,r),i=[];for(let t=0;t<o$1.length;t++){const e=o$1[t];"simplify"!==e?i.push(e):i.push(x?d$2(s.shift()):s.shift());}return i}const X=[];for(let e=0;e<A.length;e++){const t=A[e];if("cut"!==t)X.push(t);else {const e=z.shift();X.push(!0===x?d$2(e):e);}}return X}function P(e){if(!e)return null;const t=e.extent;if(!t)return null;const n=e.spatialReference&&d$1(e.spatialReference);if(!n)return t;const[o,s]=n.valid,r=2*s,{width:i}=t;let l,{xmin:f,xmax:p}=t;if([f,p]=[p,f],"extent"===e.type||0===i||i<=s||i>r||f<o||p>s)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;l=d(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;l=d(e.paths);break;case"multipoint":l=e.points;}const u=t.clone();for(let c=0;c<l.length;c++){let e=l[c][0];e<0?(e+=s,p=Math.max(e,p)):(e-=s,f=Math.min(e,f));}return u.xmin=f,u.xmax=p,u.width<i?(u.xmin-=s,u.xmax-=s,u):t}function v(e,t){const n=d$1(t);if(n){const[t,o]=n.valid,s=o-t;if(e<t)for(;e<t;)e+=s;if(e>o)for(;e>o;)e-=s;}return e}

export { b, f, i, o$1 as o, s, v };

//# sourceMappingURL=normalizeUtils-6257e368.js.map