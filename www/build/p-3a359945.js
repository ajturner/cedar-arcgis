import{i as t}from"./p-bf0e41eb.js";import{iF as r,i0 as e,hz as o,iG as n,iH as s,iI as i,iJ as a,iK as c,iL as u,iM as p,cr as f,dD as l,iN as m}from"./p-b54724b6.js";import{n as d}from"./p-8043ab9b.js";import{t as y}from"./p-0db5f47d.js";function g(t){const e=t?.origins??[void 0];return(o,n)=>{const s=b(t,o,n);for(const t of e){const e=r(o,t,n);for(const t in s)e[t]=s[t]}}}function b(t,r,e){if("resource"===t?.type)return v(t,r,e);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:r}=m;return{read:t,write:r}}}}function v(r,p,f){const l=u(p,f);return{type:String,read:(t,r,o)=>{const n=e(t,r,o);return l.type===String?n:"function"==typeof l.type?new l.type({url:n}):void 0},write:{writer(e,u,p,m){if(!m||!m.resources)return"string"==typeof e?void(u[p]=o(e,m)):void(u[p]=e.write({},m));const d=P(e),y=o(d,{...m,verifyItemRelativeUrls:m&&m.verifyItemRelativeUrls?{writtenUrls:m.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},n.NO),g=l.type!==String&&(!t(this)||m&&m.origin&&this.originIdOf(f)>s(m.origin)),b={object:this,propertyName:f,value:e,targetUrl:y,dest:u,targetPropertyName:p,context:m,params:r};m&&m.portalItem&&y&&!i(y)?g?h(b):j(b):m&&m.portalItem&&(null==y||null!=a(y)||c(y)||g)?w(b):u[p]=y}}}}function w(t){const{targetUrl:r,params:e,value:o,context:n,dest:s,targetPropertyName:i}=t;if(!n.portalItem)return;const a=p(r),u=a?.filename??d(),l=e?.prefix??a?.prefix,m=U(o,r,n),g=f(l,u),b=`${g}.${y(m)}`,v=n.portalItem.resourceFromPath(b);c(r)&&n.resources&&n.resources.pendingOperations.push(x(r).then((t=>{v.path=`${g}.${y(t)}`,s[i]=v.itemRelativeUrl})).catch((()=>{})));const w=e?.compress??!1;n.resources&&N({...t,resource:v,content:m,compress:w,updates:n.resources.toAdd}),s[i]=v.itemRelativeUrl}function h(t){const{context:r,targetUrl:e,params:o,value:n,dest:s,targetPropertyName:i}=t;if(!r.portalItem)return;const a=r.portalItem.resourceFromPath(e),c=U(n,e,r),u=y(c),p=l(a.path),f=o?.compress??!1;u===p?(r.resources&&N({...t,resource:a,content:c,compress:f,updates:r.resources.toUpdate}),s[i]=e):w(t)}function j({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function N({object:t,propertyName:r,updates:e,resource:o,content:n,compress:s}){e.push({resource:o,content:n,compress:s,finish:e=>{S(t,r,e)}})}function U(t,r,e){return"string"==typeof t?{url:r}:new Blob([JSON.stringify(t.toJSON(e))],{type:"application/json"})}async function x(t){const r=(await import("./p-b54724b6.js").then((function(t){return t.ka}))).default,{data:e}=await r(t,{responseType:"blob"});return e}function P(t){return null==t?null:"string"==typeof t?t:t.url}function S(t,r,e){"string"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{g};
//# sourceMappingURL=p-3a359945.js.map