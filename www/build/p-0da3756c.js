import{b as e,jS as r,jT as t,s as n,gE as a,gJ as u,L as l,gD as s,jU as i}from"./p-b54724b6.js";const o=e.getLogger("esri.layers.support.labelFormatUtils"),c={type:"simple",evaluate:()=>null},f={getAttribute:(e,r)=>e.field(r)};async function d(e,a,u){if(!e||!e.symbol||!a)return c;const l=e.where,s=r(e),d=l?await import("./p-b8ded059.js").then((function(e){return e.W})):null;let w;if("arcade"===s.type){const e=await t(s.expression,u,a);if(null==e)return c;w={type:"arcade",evaluate(r){try{const t=e.evaluate({$feature:"attributes"in r?e.repurposeFeature(r):r},e.services);if(null!=t)return t.toString()}catch(e){o.error(new n("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:e,feature:r,expression:s}))}return null},needsHydrationToEvaluate:()=>null==i(s.expression)}}else w={type:"simple",evaluate:e=>s.expression.replaceAll(/{[^}]*}/g,(r=>{const t=r.slice(1,-1),n=a.get(t);if(!n)return r;let u=null;if("attributes"in e){e&&e.attributes&&(u=e.attributes[n.name])}else u=e.field(n.name);return null==u?"":p(u,n)}))};if(l){let e;try{e=d.WhereClause.create(l,a)}catch(e){return o.error(new n("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:l,error:e})),c}const r=w.evaluate;w.evaluate=t=>{const a="attributes"in t?void 0:f;try{if(e.testFeature(t,a))return r(t)}catch(e){o.error(new n("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:l,feature:t,error:e}))}return null}}return w}function p(e,r){if(null==e)return"";const t=r.domain;if(t)if("codedValue"===t.type||"coded-value"===t.type){const r=e;for(const e of t.codedValues)if(e.code===r)return e.name}else if("range"===t.type){const r=+e,n="range"in t?t.range[0]:t.minValue,a="range"in t?t.range[1]:t.maxValue;if(n<=r&&r<=a)return t.name}let n=e;return"date"===r.type||"esriFieldTypeDate"===r.type?n=a(n,u("short-date")):l(r)&&(n=s(+n)),n||""}export{d as createLabelFunction,p as formatField};
//# sourceMappingURL=p-0da3756c.js.map