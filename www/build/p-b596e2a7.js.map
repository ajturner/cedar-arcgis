{"version":3,"names":["u","f","m","Object","freeze","remove","pause","resume","w","p","d","constructor","super","arguments","this","_highlightIds","Map","container","l","async","e","Array","from","graphicsViews","i","hitTest","filter","popupTemplate","flat","_graphicsViewsFeatureCollectionMap","_graphicsViews","keys","s","get","sourceLayer","layer","map","type","graphic","mapPoint","highlight","r","uid","isArray","length","t","isCollection","toArray","a","_addHighlight","_removeHighlight","update","processUpdate","attach","view","requestUpdate","featureCollections","c","featuresTilingScheme","g","graphics","source","renderer","requestUpdateCallback","set","addChild","addHandles","visible","h","updating","notifyChange","_updateHighlight","sublayers","_createGraphicsViews","onListenerAdd","onListenerRemove","_destroyGraphicsViews","detach","removeHandles","moveStart","moveEnd","viewChange","isUpdating","removeAllChildren","destroy","n","o","fadeTransitionEnabled","on","graphicUpdateHandler","push","has","delete","setHighlight","y"],"sources":["./node_modules/@arcgis/core/views/2d/layers/MapNotesLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import i from\"../../../Graphic.js\";import{isSome as s}from\"../../../core/arrayUtils.js\";import t from\"../../../core/Collection.js\";import{watch as r,on as a,initial as h}from\"../../../core/reactiveUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/has.js\";import\"../../../core/Error.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import{Container as n}from\"../engine/Container.js\";import{GroupContainer as l}from\"../engine/webgl/GroupContainer.js\";import{LayerView2DMixin as p}from\"./LayerView2D.js\";import c from\"./graphics/GraphicContainer.js\";import g from\"./graphics/GraphicsView2D.js\";import d from\"../../layers/LayerView.js\";const u=\"sublayers\",f=\"layerView\",m=Object.freeze({remove(){},pause(){},resume(){}});let w=class extends(p(d)){constructor(){super(...arguments),this._highlightIds=new Map,this.container=new l}async fetchPopupFeatures(e){return Array.from(this.graphicsViews(),(i=>i.hitTest(e).filter((e=>!!e.popupTemplate)))).flat()}*graphicsViews(){null==this._graphicsViewsFeatureCollectionMap?null==this._graphicsViews?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(e,i){return Array.from(this.graphicsViews(),(i=>{const s=i.hitTest(e);if(null!=this._graphicsViewsFeatureCollectionMap){const e=this._graphicsViewsFeatureCollectionMap.get(i);for(const i of s)!i.popupTemplate&&e.popupTemplate&&(i.popupTemplate=e.popupTemplate),i.sourceLayer=i.layer=this.layer}return s})).flat().map((i=>({type:\"graphic\",graphic:i,layer:this.layer,mapPoint:e})))}highlight(e){let r;\"number\"==typeof e?r=[e]:e instanceof i?r=[e.uid]:Array.isArray(e)&&e.length>0?r=\"number\"==typeof e[0]?e:e.map((e=>e&&e.uid)):t.isCollection(e)&&(r=e.map((e=>e&&e.uid)).toArray());const a=r?.filter(s);return a?.length?(this._addHighlight(a),{remove:()=>{this._removeHighlight(a)}}):m}update(e){for(const i of this.graphicsViews())i.processUpdate(e)}attach(){const e=this.view,i=()=>this.requestUpdate(),s=this.layer.featureCollections;if(null!=s&&s.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of s){const s=new c(this.view.featuresTilingScheme),a=new g({view:e,graphics:t.source,renderer:t.renderer,requestUpdateCallback:i,container:s});this._graphicsViewsFeatureCollectionMap.set(a,t),this.container.addChild(a.container),this.addHandles([r((()=>t.visible),(e=>a.container.visible=e),h),r((()=>a.updating),(()=>this.notifyChange(\"updating\")),h)],f)}this._updateHighlight()}else null!=this.layer.sublayers&&this.addHandles(a((()=>this.layer.sublayers),\"change\",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),u)}detach(){this._destroyGraphicsViews(),this.removeHandles(u)}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(f);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),null==this.layer.sublayers)return;const e=[],i=this.view,s=()=>this.requestUpdate();for(const t of this.layer.sublayers){const a=new n,o=new c(this.view.featuresTilingScheme);o.fadeTransitionEnabled=!0;const l=new g({view:i,graphics:t.graphics,requestUpdateCallback:s,container:o});this.addHandles([t.on(\"graphic-update\",l.graphicUpdateHandler),r((()=>t.visible),(e=>l.container.visible=e),h),r((()=>l.updating),(()=>this.notifyChange(\"updating\")),h)],f),a.addChild(l.container),this.container.addChild(a),e.push(l)}this._graphicsViews=e,this._updateHighlight()}_addHighlight(e){for(const i of e)if(this._highlightIds.has(i)){const e=this._highlightIds.get(i);this._highlightIds.set(i,e+1)}else this._highlightIds.set(i,1);this._updateHighlight()}_removeHighlight(e){for(const i of e)if(this._highlightIds.has(i)){const e=this._highlightIds.get(i)-1;0===e?this._highlightIds.delete(i):this._highlightIds.set(i,e)}this._updateHighlight()}_updateHighlight(){const e=Array.from(this._highlightIds.keys());for(const i of this.graphicsViews())i.setHighlight(e)}};w=e([o(\"esri.views.2d.layers.MapNotesLayerView2D\")],w);const y=w;export{y as default};\n"],"mappings":"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"}