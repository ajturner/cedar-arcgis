{"version":3,"names":["n","e","t","i","length","value","size","s","v","constructor","this","symbolLevels","vvColorValues","Float32Array","vvColors","vvOpacityValues","vvOpacities","vvSizeMinMaxValue","outsideLabelsVisible","_vvMaterialParameters","vvSizeEnabled","vvColorEnabled","vvRotationEnabled","vvRotationType","vvOpacityEnabled","_technique","l","getSizeVVFieldStops","_vvSizeFieldStops","type","levels","o","parseFloat","a","Math","abs","sizes","values","r","vvMaterialParameters","update","_vvInfo","_updateVisualVariables","vvRanges","setInfo","_updateEffects","rendererSchema","createOrUpdateRendererSchema","getVariation","supportsTextureFloat","getVariationHash","excludedLabelsVisible","minMaxValue","minSize","maxSize","scale","stops","set","minDataValue","maxDataValue","scaleStops","vvSizeScaleStopsValue","unitValue","spatialReference","unit","vvSizeUnitValueToPixelsRatio","resolution","fieldStops","u","color","colors","c","opacity","opacities","h","rotation","super","_rendererInfo","_materialItemsRequestQueue","attributeView","onAttributeStoreUpdate","destroy","children","forEach","removeAllChildren","clear","setRendererInfo","requestRender","async","push","items","abortOptions","resolver","promise","doRender","context","capabilities","enable","pop","_processMaterialItemRequest","renderChildren","commit","state","updateTransforms","some","hasData","setTransform","createRenderParams","rendererInfo","painter","pixelRatio","map","textureManager","rasterizeItem","symbol","glyphIds","Promise","all","then","stage","reject","id","mosaicItem","resolve"],"sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/WGLRendererInfo.js","./node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{pt2px as e}from\"../../../../core/screenUtils.js\";import{getMetersPerUnitForSR as t}from\"../../../../core/unitUtils.js\";import{meterIn as i}from\"../../../../renderers/support/lengthUtils.js\";import{isDefined as s,isNumber as a}from\"./Utils.js\";import{Technique as l}from\"./techniques/Technique.js\";import{getTechniqueFromRenderer as r}from\"./techniques/utils.js\";import{getWebGLCapabilities as o}from\"../../../webgl/capabilities.js\";function n(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}class v{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:\"geographic\",vvOpacityEnabled:!1},this._technique=l}getSizeVVFieldStops(e){const t=this._vvSizeFieldStops;if(t)switch(t.type){case\"static\":return t;case\"level-dependent\":return t.levels[e]??(()=>{let i=1/0,s=0;for(const o in t.levels){const t=parseFloat(o),a=Math.abs(e-t);a<i&&(i=a,s=t)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const a=2**((e-s)/2),l=t.levels[s],r=new Float32Array(l.values);return r[2]*=a,r[3]*=a,{sizes:l.sizes,values:r}})();default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,i){this._updateEffects(i),this._vvInfo=t,this._technique=r(e),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,e)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:o(\"2d\").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(e){this.outsideLabelsVisible=null!=e&&e.excludedLabelsVisible}_updateVisualVariables(l,r){const o=this._vvMaterialParameters;if(o.vvOpacityEnabled=!1,o.vvSizeEnabled=!1,o.vvColorEnabled=!1,o.vvRotationEnabled=!1,!l)return;const v=l.size;if(v){if(o.vvSizeEnabled=!0,v.minMaxValue){const t=v.minMaxValue;let i,l;if(s(t.minSize)&&s(t.maxSize))if(a(t.minSize)&&a(t.maxSize))i=e(t.minSize),l=e(t.maxSize);else{const s=r.scale;i=e(n(s,t.minSize.stops)),l=e(n(s,t.maxSize.stops))}this.vvSizeMinMaxValue.set([t.minDataValue,t.maxDataValue,i,l])}if(v.scaleStops&&(this.vvSizeScaleStopsValue=e(n(r.scale,v.scaleStops.stops))),v.unitValue){const e=t(r.spatialReference)/i[v.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/r.resolution}v.fieldStops&&(this._vvSizeFieldStops=v.fieldStops)}const u=l.color;u&&(o.vvColorEnabled=!0,this.vvColorValues.set(u.values),this.vvColors.set(u.colors));const c=l.opacity;c&&(o.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities));const h=l.rotation;h&&(o.vvRotationEnabled=!0,o.vvRotationType=h.type)}}export{v as WGLRendererInfo};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{createResolver as e}from\"../../../core/promiseUtils.js\";import t from\"../../../core/Queue.js\";import{AttributeStoreView as r}from\"./webgl/AttributeStoreView.js\";import s from\"./webgl/TileContainer.js\";import{WGLRendererInfo as i}from\"./webgl/WGLRendererInfo.js\";class o extends s{constructor(e){super(e),this._rendererInfo=new i,this._materialItemsRequestQueue=new t,this.attributeView=new r((()=>this.onAttributeStoreUpdate()))}destroy(){this.children.forEach((e=>e.destroy())),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(t,r){if(!t||0===t.length)return[];const s=e();return this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:s}),this.requestRender(),s.promise}doRender(e){if(e.context.capabilities.enable(\"textureFloat\"),e.context.capabilities.enable(\"vao\"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}updateTransforms(e){if(this.children.some((e=>e.hasData)))for(const t of this.children)t.setTransform(e)}createRenderParams(e){const t=super.createRenderParams(e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:s}){const{painter:i,pixelRatio:o}=e,a=t.map((e=>i.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,r)));Promise.all(a).then((e=>{if(!this.stage)return void s.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));s.resolve(r)}),s.reject)}}export{o as FeatureContainer};\n"],"mappings":"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"}