{"version":3,"names":["s","has","r","constructor","t","e","this","_array","_pool","array","length","static","acquire","expand","set","release","destroy","slice","byteLength","a","_data","ArrayBuffer","BYTE_LENGTH","_freeList","start","end","buffer","allocate","firstFit","Uint32Array","BYTES_PER_ELEMENT","free","byteOffset","i","_bytesAllocated","_pages","_pagesByBuffer","Map","_addPage","_bytesTotal","console","log","get","push"],"sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/BufferPool.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport has from\"../../../../core/has.js\";import{unwrapOrThrow as t}from\"../../../../core/maybe.js\";import{FreeList as e}from\"./cpuMapped/FreeList.js\";const s=has(\"esri-2d-log-allocations\");class r{constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}static create(t,e){const s=e.acquire(t);return new r(s,e)}expand(t){const e=this._pool.acquire(t);e.set(this._array),this._pool.release(this._array),this._array=e}destroy(){this._pool.release(this._array)}set(t,e){this._array.set(t._array,e)}slice(){const t=this._pool.acquire(this._array.byteLength);return t.set(this._array),new r(t,this._pool)}}class a{constructor(){this._data=new ArrayBuffer(a.BYTE_LENGTH),this._freeList=new e({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(t){const e=this._freeList.firstFit(t);return null==e?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}free(t){this._freeList.free(t.byteOffset,t.byteLength)}}class i{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*a.BYTE_LENGTH}acquire(e){if(this._bytesAllocated+=e,s&&console.log(`Allocating ${e}, (${this._bytesAllocated} / ${this._bytesTotal})`),e>a.BYTE_LENGTH)return new Uint32Array(e/Uint32Array.BYTES_PER_ELEMENT);for(const t of this._pages){const s=t.allocate(e);if(null!=s)return s}return t(this._addPage().allocate(e),\"Expected to allocate page\")}release(t){this._bytesAllocated-=t.byteLength,s&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(t.buffer);e&&e.free(t)}_addPage(){const t=new a;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}export{i as BufferPool,r as TypedBuffer};\n"],"mappings":"gFAIsJ,MAAMA,EAAEC,EAAI,2BAA2B,MAAMC,EAAEC,YAAYC,EAAEC,GAAGC,KAAKC,OAAOH,EAAEE,KAAKE,MAAMH,CAAC,CAAKI,YAAQ,OAAOH,KAAKC,MAAM,CAAKG,aAAS,OAAOJ,KAAKC,OAAOG,MAAM,CAACC,cAAcP,EAAEC,GAAG,MAAML,EAAEK,EAAEO,QAAQR,GAAG,OAAO,IAAIF,EAAEF,EAAEK,EAAE,CAACQ,OAAOT,GAAG,MAAMC,EAAEC,KAAKE,MAAMI,QAAQR,GAAGC,EAAES,IAAIR,KAAKC,QAAQD,KAAKE,MAAMO,QAAQT,KAAKC,QAAQD,KAAKC,OAAOF,CAAC,CAACW,UAAUV,KAAKE,MAAMO,QAAQT,KAAKC,OAAO,CAACO,IAAIV,EAAEC,GAAGC,KAAKC,OAAOO,IAAIV,EAAEG,OAAOF,EAAE,CAACY,QAAQ,MAAMb,EAAEE,KAAKE,MAAMI,QAAQN,KAAKC,OAAOW,YAAY,OAAOd,EAAEU,IAAIR,KAAKC,QAAQ,IAAIL,EAAEE,EAAEE,KAAKE,MAAM,EAAE,MAAMW,EAAEhB,cAAcG,KAAKc,MAAM,IAAIC,YAAYF,EAAEG,aAAahB,KAAKiB,UAAU,IAAIlB,EAAE,CAACmB,MAAM,EAAEC,IAAInB,KAAKc,MAAMF,YAAY,CAAYI,yBAAc,OAAO,IAAI,CAAKI,aAAS,OAAOpB,KAAKc,KAAK,CAACO,SAASvB,GAAG,MAAMC,EAAEC,KAAKiB,UAAUK,SAASxB,GAAG,OAAO,MAAMC,EAAE,KAAK,IAAIwB,YAAYvB,KAAKc,MAAMf,EAAED,EAAEyB,YAAYC,kBAAkB,CAACC,KAAK3B,GAAGE,KAAKiB,UAAUQ,KAAK3B,EAAE4B,WAAW5B,EAAEc,WAAW,EAAE,MAAMe,EAAE9B,cAAcG,KAAK4B,gBAAgB,EAAE5B,KAAK6B,OAAO,GAAG7B,KAAK8B,eAAe,IAAIC,IAAI/B,KAAKgC,UAAU,CAACtB,UAAUV,KAAK6B,OAAO,GAAG7B,KAAK8B,eAAe,IAAI,CAAKG,kBAAc,OAAOjC,KAAK6B,OAAOzB,OAAOS,EAAEG,WAAW,CAACV,QAAQP,GAAG,GAAGC,KAAK4B,iBAAiB7B,EAAEL,GAAGwC,QAAQC,IAAI,cAAcpC,OAAOC,KAAK4B,qBAAqB5B,KAAKiC,gBAAgBlC,EAAEc,EAAEG,YAAY,OAAO,IAAIO,YAAYxB,EAAEwB,YAAYC,mBAAmB,IAAI,MAAM1B,KAAKE,KAAK6B,OAAO,CAAC,MAAMnC,EAAEI,EAAEuB,SAAStB,GAAG,GAAG,MAAML,EAAE,OAAOA,CAAC,CAAC,OAAOI,EAAEE,KAAKgC,WAAWX,SAAStB,GAAG,4BAA4B,CAACU,QAAQX,GAAGE,KAAK4B,iBAAiB9B,EAAEc,WAAWlB,GAAGwC,QAAQC,IAAI,WAAWrC,EAAEc,gBAAgBZ,KAAK4B,qBAAqB5B,KAAKiC,gBAAgB,MAAMlC,EAAEC,KAAK8B,eAAeM,IAAItC,EAAEsB,QAAQrB,GAAGA,EAAE0B,KAAK3B,EAAE,CAACkC,WAAW,MAAMlC,EAAE,IAAIe,EAAE,OAAOb,KAAK6B,OAAOQ,KAAKvC,GAAGE,KAAK8B,eAAetB,IAAIV,EAAEsB,OAAOtB,GAAGA,CAAC,S"}