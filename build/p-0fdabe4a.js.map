{"version":3,"names":["i","e","t","n","r","s","d","originPosition","l","a","h","u","translate","scale","c","constructor","this","_options","geometryTypes","_previousCoordinate","_transform","_applyTransform","_lengths","_currentLengthIndex","_toAddInCurrentPath","_vertexDimension","_coordinateBuffer","_coordinateBufferPtr","_attributesConstructor","createFeatureResult","fields","features","finishFeatureResult","applyTransform","transform","length","hasZ","geometryType","sourceSpatialReference","spatialReference","geometry","createSpatialReference","addField","push","o","map","name","addFeature","prepareFeatures","_deriveApplyTransform","hasM","addCoordinate","addCoordinatePoint","createGeometry","createPointGeometry","_addCoordinatePolygon","_createPolygonGeometry","_addCoordinatePolyline","_createPolylineGeometry","_addCoordinateMultipoint","_createMultipointGeometry","createFeature","attributes","allocateCoordinates","addLength","addQueryGeometry","queryGeometry","queryGeometryType","clone","x","y","z","m","_transformPathLikeValue","_dehydratedAddPointsCoordinate","paths","rings","points","Array","async","p","from","quantizationParameters","data","f"],"sources":["./node_modules/@arcgis/core/rest/query/operations/pbfJSONFeatureSet.js","./node_modules/@arcgis/core/rest/query/executeQueryPBF.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{assertIsSome as e,unwrapOrThrow as t}from\"../../../core/maybe.js\";import{getGeometryZScaler as r}from\"../../../geometry/support/zscale.js\";import{unquantizeOptimizedGeometry as s,convertToGeometry as o}from\"../../../layers/graphics/featureConversionUtils.js\";function i(e,t){return t}function n(e,t,r,s){switch(r){case 0:return d(e,t+s,0);case 1:return\"lowerLeft\"===e.originPosition?d(e,t+s,1):l(e,t+s,1)}}function a(e,t,r,s){return 2===r?d(e,t,2):n(e,t,r,s)}function h(e,t,r,s){return 2===r?d(e,t,3):n(e,t,r,s)}function u(e,t,r,s){return 3===r?d(e,t,3):a(e,t,r,s)}function d({translate:e,scale:t},r,s){return e[s]+r*t[s]}function l({translate:e,scale:t},r,s){return e[s]-r*t[s]}class c{constructor(e){this._options=e,this.geometryTypes=[\"esriGeometryPoint\",\"esriGeometryMultipoint\",\"esriGeometryPolyline\",\"esriGeometryPolygon\"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=i,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;const t=r(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(null!=t)for(const r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(t,r){const s=t.fields;e(s),s.push(r);const o=s.map((e=>e.name));this._attributesConstructor=function(){for(const e of o)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++,e.geometryType){case\"esriGeometryPoint\":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case\"esriGeometryPolygon\":this.addCoordinate=(e,t,r)=>this._addCoordinatePolygon(e,t,r),this.createGeometry=e=>this._createPolygonGeometry(e);break;case\"esriGeometryPolyline\":this.addCoordinate=(e,t,r)=>this._addCoordinatePolyline(e,t,r),this.createGeometry=e=>this._createPolylineGeometry(e);break;case\"esriGeometryMultipoint\":this.addCoordinate=(e,t,r)=>this._addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this._createMultipointGeometry(e)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this._lengths.length&&(this._toAddInCurrentPath=t),this._lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:r,queryGeometryType:i}=t,n=s(r.clone(),r,!1,!1,this._transform),a=o(n,i,!1,!1);e.queryGeometryType=i,e.queryGeometry={...a}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,r,s){const o=t(this._transform,\"transform\");switch(r=this._applyTransform(o,r,s,0),s){case 0:e.x=r;break;case 1:e.y=r;break;case 2:\"z\"in e?e.z=r:e.m=r;break;case 3:e.m=r}}_transformPathLikeValue(e,r){let s=0;r<=1&&(s=this._previousCoordinate[r],this._previousCoordinate[r]+=e);const o=t(this._transform,\"transform\");return this._applyTransform(o,e,r,s)}_addCoordinatePolyline(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}_addCoordinatePolygon(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}_addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const s=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(s)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this._toAddInCurrentPath--&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const s=this._transformPathLikeValue(t,r),o=e[e.length-1];0===r&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),o.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=s}_deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?u:t?a:r?h:n}}export{c as JSONFeatureSetParserContext};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{parseUrl as r}from\"../utils.js\";import{JSONFeatureSetParserContext as e}from\"./operations/pbfJSONFeatureSet.js\";import{executeQueryPBF as t}from\"./operations/query.js\";import o from\"../support/FeatureSet.js\";import a from\"../support/Query.js\";async function s(r,e,t){const s=await n(r,a.from(e),t);return o.fromJSON(s)}async function n(o,s,n){const p=r(o),i={...n},u=a.from(s),m=!u.quantizationParameters,{data:f}=await t(p,u,new e({sourceSpatialReference:u.sourceSpatialReference,applyTransform:m}),i);return f}export{s as executeQueryPBF,n as executeRawQueryPBF};\n"],"mappings":"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"}