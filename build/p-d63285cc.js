import{k as t,l as p,he as i,n as s,P as r,c as e,ac as o}from"./p-98455486.js";import{i as a}from"./p-6133cc0f.js";import{a as m}from"./p-ca3c9a87.js";import{f as j,d as h}from"./p-f7917469.js";import{o as c}from"./p-bd7f9fc7.js";import{n as d}from"./p-f2824b64.js";import{v as f}from"./p-659e0d38.js";import{m as b}from"./p-ef8e047f.js";import{a as n}from"./p-4c46e2fb.js";import{U as l,r as u}from"./p-e89101d7.js";import"./p-ed1a11ab.js";import"./p-07f12c16.js";import"./p-1abe3c64.js";import"./p-908b7a05.js";import"./p-7099a764.js";import"./p-0c70c0e2.js";import"./p-13e550f5.js";import"./p-795f7c81.js";import"./p-7dc0ec82.js";import"./p-0e94eaa4.js";import"./p-620ed352.js";import"./p-9f1a0adc.js";import"./p-220b11a0.js";import"./p-4f76b2d1.js";import"./p-2d1dac84.js";import"./p-42c332a2.js";import"./p-5572f01a.js";import"./p-38e70926.js";import"./p-3a9bb31c.js";import"./p-783b6965.js";import"./p-8399f9e1.js";import"./p-e6a64715.js";import"./p-dc29c329.js";import"./p-d46be2b1.js";import"./p-fc9cd10b.js";import"./p-4f27d9ab.js";import"./p-ecc7ed03.js";import"./p-c5929b55.js";import"./p-8043ab9b.js";import"./p-4cbc7b66.js";import"./p-f5452a6b.js";import"./p-8b2bb530.js";import"./p-9a4094ba.js";import"./p-a9fef357.js";import"./p-0d2202fd.js";import"./p-f33b44a5.js";import"./p-e91d9d8d.js";import"./p-e22a21a4.js";import"./p-958a5da8.js";import"./p-fcbd27c0.js";import"./p-5abe9c67.js";import"./p-66f65b6a.js";import"./p-14843b2a.js";import"./p-ffb89da5.js";import"./p-dfd7ee02.js";import"./p-da8336be.js";import"./p-1172b129.js";import"./p-0fdabe4a.js";import"./p-9803a24d.js";import"./p-b15bfa44.js";import"./p-baa730bb.js";import"./p-e1758a64.js";import"./p-ec443a8b.js";import"./p-f4b056c3.js";import"./p-e75aa2b5.js";import"./p-f5f26b1f.js";import"./p-b8afab55.js";import"./p-c782b111.js";import"./p-2b6b8db8.js";import"./p-50b034e8.js";import"./p-6bb7b693.js";import"./p-de65627f.js";import"./p-a3c11f30.js";import"./p-b0610ac0.js";import"./p-073c3089.js";import"./p-c6ce33a2.js";import"./p-af5dfb20.js";import"./p-cc77f67d.js";import"./p-69ec1c26.js";import"./p-83c727f2.js";import"./p-a18c7841.js";import"./p-eda79132.js";import"./p-5977fcaf.js";import"./p-eeca6bc1.js";import"./p-21ae9bf7.js";import"./p-aedab47c.js";import"./p-f705ab94.js";import"./p-3c3976eb.js";import"./p-623dbe5e.js";import"./p-4a6353a7.js";import"./p-238fbe63.js";import"./p-1382d09e.js";import"./p-b4b7d6a0.js";import"./p-fde2045e.js";import"./p-6b09cddc.js";import"./p-3142f421.js";import"./p-5f505b32.js";import"./p-1ba2f0a8.js";const g=r=>{let e=class extends r{initialize(){this.exportImageParameters=new b({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return t([p()],e.prototype,"exportImageParameters",void 0),t([p({readOnly:!0})],e.prototype,"floors",null),t([p({readOnly:!0})],e.prototype,"exportImageVersion",null),t([p()],e.prototype,"layer",void 0),t([p()],e.prototype,"suspended",void 0),t([p(i)],e.prototype,"timeExtent",void 0),e=t([s("esri.views.layers.MapImageLayerView")],e),e};let y=class extends(g(n(j(h)))){constructor(){super(...arguments),this._highlightGraphics=new a,this._updateHash=""}fetchPopupFeatures(t,p){return this._popupHighlightHelper.fetchPopupFeatures(t,p)}update(t){const p=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==p&&(this._updateHash=p,this.strategy.update(t).catch((t=>{r(t)||e.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:p,version:i}=this.layer,s=i>=10.3,r=i>=10;this._bitmapContainer=new m,this.container.addChild(this._bitmapContainer),this._highlightView=new c({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new d(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new l({createFetchPopupFeaturesQueryGeometry:(t,p)=>u(t,p,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,p)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:p})},layerView:this,updatingHandles:this.updatingHandles}),this.strategy=new f({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:p,imageRotationSupported:s,imageNormalizationSupported:r,hidpi:!0}),this.addAttachHandles(o((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,p,i,s){return this.layer.fetchImage(t,p,i,{timeExtent:this.timeExtent,floors:this.floors,...s})}fetchImageBitmap(t,p,i,s){return this.layer.fetchImageBitmap(t,p,i,{timeExtent:this.timeExtent,floors:this.floors,...s})}highlight(t){return this._popupHighlightHelper.highlight(t)}};t([p()],y.prototype,"strategy",void 0),t([p()],y.prototype,"updating",void 0),y=t([s("esri.views.2d.layers.MapImageLayerView2D")],y);const x=y;export default x;
//# sourceMappingURL=p-d63285cc.js.map