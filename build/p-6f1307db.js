import{e7 as n,ek as t,el as r,ee as e,az as o,em as s,k as a,l as i,n as u,o as l,cV as c,en as f,cW as p,eo as m,ep as g,eq as y,er as h,es as w,c as A,et as F,eu as b,ev as v,ew as j,ex as x,ey as P,ez as d,ed as C,eA as M,eB as N,eC as T,aI as _,eD as S,eE as B,cM as I,eF as R}from"./p-98455486.js";import{e as z}from"./p-de65f975.js";import{e as O,o as k}from"./p-cc24e5bd.js";import{a as q,o as E,g as L,B as $}from"./p-b8afab55.js";import{c as D}from"./p-233676c3.js";import{m as U,p as V,t as W,o as G}from"./p-28b18b6c.js";import{m as H}from"./p-0a76eb6d.js";import{v as J,y as K,x as Q}from"./p-cfc993db.js";import{e as X}from"./p-603bf978.js";import{n as Y,s as Z,r as nn}from"./p-49fcc632.js";import{i as tn,T as rn}from"./p-9bee320e.js";function en(n=pn){return[n[0],n[1],n[2],n[3]]}function on(t,r,e=en()){return n(un(e),t),e[3]=r,e}function sn(n,t,r=en()){return J(mn,un(n),cn(n)),J(gn,un(t),cn(t)),K(mn,gn,mn),fn(r,o(Q(un(r),mn)))}function an(n,e,o,a=en()){return on(s,n,yn),on(t,e,hn),on(r,o,wn),sn(yn,hn,yn),sn(yn,wn,a),a}function un(n){return n}function ln(n){return n[3]}function cn(n){return e(n[3])}function fn(n,t){return n[3]=t,n}const pn=[0,0,1,0],mn=X(),gn=X(),yn=en(),hn=en(),wn=en();var An;let Fn=An=class extends l{constructor(n){super(n),this.translation=c(),this.rotationAxis=f(pn),this.rotationAngle=0,this.scale=p(1,1,1)}get rotation(){return on(this.rotationAxis,this.rotationAngle)}set rotation(n){this.rotationAxis=m(un(n)),this.rotationAngle=ln(n)}get localMatrix(){const n=O();return J(bn,un(this.rotation),cn(this.rotation)),g(n,bn,this.translation,this.scale),n}get localMatrixInverse(){return y(O(),this.localMatrix)}applyLocal(n,t){return h(t,n,this.localMatrix)}applyLocalInverse(n,t){return h(t,n,this.localMatrixInverse)}equals(n){return this===n||null!=n&&w(this.localMatrix,n.localMatrix)}clone(){const n={translation:m(this.translation),rotationAxis:m(this.rotationAxis),rotationAngle:this.rotationAngle,scale:m(this.scale)};return new An(n)}};a([i({type:[Number],nonNullable:!0,json:{write:!0}})],Fn.prototype,"translation",void 0),a([i({type:[Number],nonNullable:!0,json:{write:!0}})],Fn.prototype,"rotationAxis",void 0),a([i({type:Number,nonNullable:!0,json:{write:!0}})],Fn.prototype,"rotationAngle",void 0),a([i({type:[Number],nonNullable:!0,json:{write:!0}})],Fn.prototype,"scale",void 0),a([i()],Fn.prototype,"rotation",null),a([i()],Fn.prototype,"localMatrix",null),a([i()],Fn.prototype,"localMatrixInverse",null),Fn=An=a([u("esri.geometry.support.MeshTransform")],Fn);const bn=X(),vn=Fn;function jn(n,t){return n.isGeographic||n.isWebMercator&&(t?.geographic??!0)}function xn(n,t,r){const e=!n.isGeoreferenced;null!=r?.geographic&&r.geographic!==e&&A.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${r.geographic}) for a Mesh vertex space of type "${n.type}" is not supported. This parameter will be ignored.`)}const Pn=A.getLogger("esri.geometry.support.meshUtils.normalProjection");function dn(n,t,r,e,o){return Rn(e)?(In(kn.TO_PCPF,tn.fromTypedArray(n),rn.fromTypedArray(t),rn.fromTypedArray(r),e,tn.fromTypedArray(o)),o):(Pn.error("Cannot convert spatial reference to PCPF"),o)}function Cn(n,t,r,e,o){return Rn(e)?(In(kn.FROM_PCPF,tn.fromTypedArray(n),rn.fromTypedArray(t),rn.fromTypedArray(r),e,tn.fromTypedArray(o)),o):(Pn.error("Cannot convert to spatial reference from PCPF"),o)}function Mn(n,t,r){return F(n,t,0,r,D(t),0,n.length/3),r}function Nn(n,t,r){return F(n,D(r),0,t,r,0,n.length/3),t}function Tn(n,t,r){return L($n,r),Y(t,n,$n),$($n)||Z(t,t),t}function _n(n,t,r){if(L($n,r),Y(t,n,$n,4),$($n)||Z(t,t,4),n!==t)for(let r=3;r<n.length;r+=4)t[r]=n[r];return t}function Sn(n,t,r,e,o){if(!Rn(e))return Pn.error("Cannot convert spatial reference to PCPF"),o;In(kn.TO_PCPF,tn.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),rn.fromTypedArray(t),rn.fromTypedArray(r),e,tn.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let t=3;t<n.length;t+=4)o[t]=n[t];return o}function Bn(n,t,r,e,o){if(!Rn(e))return Pn.error("Cannot convert to spatial reference from PCPF"),o;In(kn.FROM_PCPF,tn.fromTypedArray(n,16),rn.fromTypedArray(t),rn.fromTypedArray(r),e,tn.fromTypedArray(o,16));for(let t=3;t<n.length;t+=4)o[t]=n[t];return o}function In(n,t,r,e,o,s){if(!t)return;const a=r.count,i=D(o);if(zn(o))for(let r=0;r<a;r++)e.getVec(r,qn),t.getVec(r,En),x(i,qn,Ln,i),q($n,Ln),n===kn.FROM_PCPF&&E($n,$n),P(En,En,$n),s.setVec(r,En);else for(let o=0;o<a;o++){e.getVec(o,qn),t.getVec(o,En),x(i,qn,Ln,i),q($n,Ln);const a=d(r.get(o,1));let u=Math.cos(a);n===kn.TO_PCPF&&(u=1/u),$n[0]*=u,$n[1]*=u,$n[2]*=u,$n[3]*=u,$n[4]*=u,$n[5]*=u,n===kn.FROM_PCPF&&E($n,$n),P(En,En,$n),C(En,En),s.setVec(o,En)}return s}function Rn(n){return zn(n)||On(n)}function zn(n){return n.isWGS84||b(n)||v(n)||j(n)}function On(n){return n.isWebMercator}var kn;!function(n){n[n.TO_PCPF=0]="TO_PCPF",n[n.FROM_PCPF=1]="FROM_PCPF"}(kn||(kn={}));const qn=c(),En=c(),Ln=O(),$n=z();function Dn(n,t,r){return jn(t.spatialReference,r)?Kn(n,t,r):Jn(n,t,r)}function Un(n,t,r,e){const{position:o,normal:s,tangent:a}=n;if(!t.isRelative)return{position:o,normal:s,tangent:a};const i=r?.localMatrix??k;return Dn({position:nn(new Float64Array(o.length),o,i),normal:null!=s?Tn(s,new Float32Array(s.length),i):null,tangent:null!=a?_n(a,new Float32Array(a.length),i):null},t.getOriginPoint(e),{geographic:!t.isGeoreferenced})}function Vn(n,t,r){if(r?.useTransform){const{position:e,normal:o,tangent:s}=n,{x:a,y:i,z:u}=t,l=p(a,i,u??0);return{vertexAttributes:{position:e,normal:o,tangent:s},vertexSpace:r.geographic??1?new U({origin:l}):new H({origin:l}),transform:new vn}}return{vertexAttributes:Dn(n,t,r),vertexSpace:new V,transform:null}}function Wn(n,t,r){return jn(t.spatialReference,r)?nt(n,t,r):Zn(n,t,r)}function Gn(n,t,r,e,o){if(!t.isRelative)return Wn(n,e,o);const{spatialReference:s}=e,a=Un(n,t,r,s);return e.equals(t.getOriginPoint(s))?Zn(a,e,o):Wn(a,e,o)}function Hn({positions:n,transform:t,vertexSpace:r,inSpatialReference:e,outSpatialReference:o,outPositions:s,local:a}){const i=r.isRelative?r.origin:T,u=r.isRelative?t?.localMatrix??k:k;if(r.isGeoreferenced){const t=s??W(n.length);if(M(u,k)?G(t,n):nn(t,n,u),!N(i,T)){const[n,r,e]=i;for(let o=0;o<t.length;o+=3)t[o]+=n,t[o+1]+=r,t[o+2]+=e}return F(t,e,0,t,o,0,t.length/3),t}const l=D(e),c=!a&&_(e,l)?l:e;x(e,i,at,c),S(at,at,u);const f=s??W(n.length);return nn(f,n,at),F(f,c,0,f,o,0,f.length/3),f}function Jn(n,t,r){const e=new Float64Array(n.position.length),o=n.position,s=t.x,a=t.y,i=t.z??0,u=st(r?r.unit:null,t.spatialReference);for(let n=0;n<o.length;n+=3)e[n]=o[n]*u+s,e[n+1]=o[n+1]*u+a,e[n+2]=o[n+2]*u+i;return{position:e,normal:n.normal,tangent:n.tangent}}function Kn(n,t,r){const e=t.spatialReference,o=tt(t,r,at),s=new Float64Array(n.position.length),a=Qn(n.position,o,e,s),i=L(ut,o);return{position:a,normal:Xn(a,s,n.normal,i,e),tangent:Yn(a,s,n.tangent,i,e)}}function Qn(n,t,r,e){nn(e,n,t);const o=new Float64Array(n.length);return Nn(e,o,r)}function Xn(n,t,r,e,o){if(null==r)return null;const s=new Float32Array(r.length);return Y(s,r,e),Cn(s,n,t,o,s),s}function Yn(n,t,r,e,o){if(null==r)return null;const s=new Float32Array(r.length);Y(s,r,e,4);for(let n=3;n<s.length;n+=4)s[n]=r[n];return Bn(s,n,t,o,s),s}function Zn(n,t,r){const e=new Float64Array(n.position.length),o=n.position,s=t.x,a=t.y,i=t.z??0,u=st(r?r.unit:null,t.spatialReference);for(let n=0;n<o.length;n+=3)e[n]=(o[n]-s)/u,e[n+1]=(o[n+1]-a)/u,e[n+2]=(o[n+2]-i)/u;return{position:e,normal:n.normal,tangent:n.tangent}}function nt(n,t,r){const e=t.spatialReference;tt(t,r,at);const o=y(it,at),s=new Float64Array(n.position.length),a=rt(n.position,e,o,s),i=L(ut,o);return{position:a,normal:et(n.normal,n.position,s,e,i),tangent:ot(n.tangent,n.position,s,e,i)}}function tt(n,t,r){x(n.spatialReference,[n.x,n.y,n.z??0],r,D(n.spatialReference));const e=st(t?t.unit:null,n.spatialReference);return B(r,r,[e,e,e]),r}function rt(n,t,r,e){const o=Mn(n,t,e),s=new Float64Array(o.length);return nn(s,o,r),s}function et(n,t,r,e,o){if(null==n)return null;const s=dn(n,t,r,e,new Float32Array(n.length));return Y(s,s,o),s}function ot(n,t,r,e,o){if(null==n)return null;const s=Sn(n,t,r,e,new Float32Array(n.length));return Y(s,s,o,4),s}function st(n,t){if(null==n)return 1;const r=I(t);return 1/R(r,"meters",n)}const at=O(),it=O(),ut=z();const lt=Object.freeze({__proto__:null,georeference:Dn,georeferenceApplyTransform:Un,georeferenceByTransform:Vn,project:Hn,ungeoreference:Wn,ungeoreferenceByTransform:Gn});export{Wn as D,Nn as E,Hn as I,vn as N,Dn as O,Sn as R,Un as T,dn as _,en as a,Gn as b,lt as c,sn as g,Mn as h,Cn as j,an as l,xn as o,Vn as q,jn as r,Bn as v,cn as w,un as x};
//# sourceMappingURL=p-6f1307db.js.map