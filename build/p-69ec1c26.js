import{c as e,s as n,fg as t,bX as s}from"./p-98455486.js";import{$ as r,L as l,r as i}from"./p-7dc0ec82.js";import{t as a}from"./p-1abe3c64.js";const u=8388607,o=8388608,c=254,f=255,v=0,p=1,d=e=>(e&o)>>>23,w=e=>e&u,y=e=>d(e)===p?c:f;function m(e){return d(e)===p}function b(e,n){return((n?o:0)|e)>>>0}const g=(e,n)=>e&&((...e)=>n.warn("DEBUG:",...e))||(()=>null),h=!1;function z(t){return r(t.minDataValue)&&r(t.maxDataValue)&&null!=t.minSize&&null!=t.maxSize?l.SIZE_MINMAX_VALUE:(t.expression&&"view.scale"===t.expression||t.valueExpression&&"$view.scale"===t.valueExpression)&&Array.isArray(t.stops)?l.SIZE_SCALE_STOPS:(null!=t.field||t.expression&&"view.scale"!==t.expression||t.valueExpression&&"$view.scale"!==t.valueExpression)&&(Array.isArray(t.stops)||"levels"in t&&t.levels)?l.SIZE_FIELD_STOPS:(null!=t.field||t.expression&&"view.scale"!==t.expression||t.valueExpression&&"$view.scale"!==t.valueExpression)&&null!=t.valueUnit?l.SIZE_UNIT_VALUE:(e.getLogger("esri.views.2d.engine.webgl").error(new n("mapview-bad-type","Found invalid size VisualVariable",t)),l.NONE)}function F(e,n){if(!e||!n)return e;switch(n){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function x(e){return{value:e.value,size:t(e.size)}}function A(e){return(e??[]).map((e=>x(e)))}function M(e){if("string"==typeof e||"number"==typeof e)return t(e);const n=e;return{type:"size",expression:n.expression,stops:A(n.stops)}}const V=e=>{const n=[],t=[],r=A(e),l=r.length;for(let e=0;e<6;e++){const i=r[Math.min(e,l-1)];n.push(i.value),t.push(null==i.size?a:s(i.size))}return{values:new Float32Array(n),sizes:new Float32Array(t)}};function j(e){const n=e&&e.length>0?{}:null,t=n?{}:null;if(!n||!t)return{vvFields:n,vvRanges:t};for(const s of e)if(s.field&&(n[s.type]=s.field),"size"===s.type){t.size||(t.size={});const e=s;switch(z(e)){case l.SIZE_MINMAX_VALUE:t.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:M(e.minSize),maxSize:M(e.maxSize)};break;case l.SIZE_SCALE_STOPS:t.size.scaleStops={stops:A(e.stops)};break;case l.SIZE_FIELD_STOPS:if(e.levels){const n={};for(const t in e.levels)n[t]=V(e.levels[t]);t.size.fieldStops={type:"level-dependent",levels:n}}else t.size.fieldStops={type:"static",...V(e.stops)};break;case l.SIZE_UNIT_VALUE:t.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation??void 0}}}else if("color"===s.type)t.color=R(s);else if("opacity"===s.type)t.opacity=k(s);else if("rotation"===s.type){const e=s;t.rotation={type:e.rotationType}}return{vvFields:n,vvRanges:t}}function k(e){const n={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const t=e.stops;for(let e=0;e<8;++e){const s=t[Math.min(e,t.length-1)];n.values[e]=s.value,n.opacities[e]=s.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const t=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;for(let e=0;e<8;e++)n.values[e]=1/0,n.opacities[e]=t}}return n}function D(e,n,t){e[4*n]=t.r/255,e[4*n+1]=t.g/255,e[4*n+2]=t.b/255,e[4*n+3]=t.a}function R(e){if(null==e)return null;if(e.normalizationField)return null;const n={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;n.field=e.field;const t=e.stops;for(let e=0;e<8;++e){const s=t[Math.min(e,t.length-1)];n.values[e]=s.value,D(n.colors,e,s.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let e=0;e<8;e++)n.values[e]=1/0,D(n.colors,e,t)}}for(let e=0;e<32;e+=4)i(n.colors,e,!0);return n}export{g as a,F as b,p as c,z as d,d as e,w as f,j as g,y as i,h as l,u as n,m as p,b as s,v as u};
//# sourceMappingURL=p-69ec1c26.js.map