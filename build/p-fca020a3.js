import{k as t,l as s,bl as e,n as i,ac as p,s as r,fb as o,M as a}from"./p-98455486.js";import n from"./p-affd6ef9.js";import{e as m}from"./p-a18c7841.js";import"./p-5572f01a.js";import"./p-07f12c16.js";import"./p-1abe3c64.js";import"./p-13e550f5.js";import"./p-7099a764.js";import"./p-0c70c0e2.js";import"./p-f7917469.js";import"./p-d46be2b1.js";import"./p-fc9cd10b.js";import"./p-4f27d9ab.js";import"./p-ecc7ed03.js";import"./p-c5929b55.js";import"./p-8043ab9b.js";import"./p-4cbc7b66.js";import"./p-3a9bb31c.js";import"./p-f5452a6b.js";import"./p-8b2bb530.js";import"./p-9a4094ba.js";import"./p-9f1a0adc.js";import"./p-a9fef357.js";import"./p-0d2202fd.js";import"./p-f33b44a5.js";import"./p-e91d9d8d.js";import"./p-e22a21a4.js";import"./p-958a5da8.js";import"./p-fcbd27c0.js";import"./p-5abe9c67.js";import"./p-66f65b6a.js";import"./p-14843b2a.js";import"./p-ffb89da5.js";import"./p-dfd7ee02.js";import"./p-da8336be.js";import"./p-1172b129.js";import"./p-e6a64715.js";import"./p-dc29c329.js";import"./p-0fdabe4a.js";import"./p-8399f9e1.js";import"./p-9803a24d.js";import"./p-b15bfa44.js";import"./p-baa730bb.js";import"./p-e1758a64.js";import"./p-ec443a8b.js";import"./p-f4b056c3.js";import"./p-6133cc0f.js";import"./p-e75aa2b5.js";import"./p-f5f26b1f.js";import"./p-783b6965.js";import"./p-b8afab55.js";import"./p-2d1dac84.js";import"./p-c782b111.js";import"./p-af5dfb20.js";import"./p-cc77f67d.js";import"./p-7dc0ec82.js";import"./p-0e94eaa4.js";import"./p-795f7c81.js";import"./p-ed1a11ab.js";import"./p-908b7a05.js";import"./p-620ed352.js";import"./p-220b11a0.js";import"./p-4f76b2d1.js";import"./p-42c332a2.js";import"./p-38e70926.js";import"./p-69ec1c26.js";import"./p-83c727f2.js";import"./p-2b6b8db8.js";import"./p-50b034e8.js";import"./p-6bb7b693.js";import"./p-de65627f.js";import"./p-a3c11f30.js";import"./p-17257453.js";import"./p-fde2045e.js";import"./p-1382d09e.js";import"./p-30bab7e4.js";import"./p-1ecac668.js";import"./p-238fbe63.js";import"./p-6b09cddc.js";import"./p-1ba2f0a8.js";import"./p-4c46e2fb.js";const c=p=>{let r=class extends p{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}constructor(...t){super(...t),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return this._isUserPaused?"paused":this._streamConnectionStatus}_onSuspendedChange(t){t?this._doPause():this._isUserPaused||this._doResume()}};return t([s()],r.prototype,"_isUserPaused",void 0),t([s({readOnly:!0})],r.prototype,"connectionStatus",null),t([s({type:e})],r.prototype,"filter",void 0),r=t([i("esri.layers.mixins.StreamLayerView")],r),r};function j(t,s){if(null==t&&null==s)return null;const e={};return null!=s&&(e.geometry=s.toJSON()),null!=t&&(e.where=t),e}let d=class extends(c(n)){constructor(){super(...arguments),this.pipelineConnectionStatus="disconnected",this.pipelineErrorString=null,this._enabledEventTypes=new Set}initialize(){this.addHandles([p((()=>this.layer.customParameters),(t=>this._proxy.updateCustomParameters(t))),this.layer.on("send-message-to-socket",(t=>this._proxy.sendMessageToSocket(t))),this.layer.on("send-message-to-client",(t=>this._proxy.sendMessageToClient(t))),p((()=>this.layer.purgeOptions),(()=>this._update())),p((()=>this.suspended),this._onSuspendedChange.bind(this))],"constructor")}get connectionError(){return this.pipelineErrorString?new r("stream-controller",this.pipelineErrorString):null}on(t,s){if(Array.isArray(t))return o(t.map((t=>this.on(t,s))));const e=["data-received","message-received"].includes(t);e&&(this._enabledEventTypes.add(t),this._proxy.enableEvent(t,!0));const i=super.on(t,s),p=this;return{remove(){i.remove(),e&&(p._proxy.closed||p.hasEventListener(t)||p._proxy.enableEvent(t,!1))}}}queryLatestObservations(t,s){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new r("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(t),s).then((t=>{const s=a.fromJSON(t);return s.features.forEach((t=>{t.layer=this.layer,t.sourceLayer=this.layer})),s}))}detach(){super.detach(),this.pipelineConnectionStatus="disconnected"}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){this._proxy?.pauseStream()}_doResume(){this._proxy?.resumeStream()}_createClientOptions(){return{...super._createClientOptions(),setProperty:t=>{this.set(t.propertyName,t.value)}}}_createTileRendererHash(t){const s=`${JSON.stringify(this.layer.purgeOptions)}.${JSON.stringify(j(this.layer.definitionExpression,this.layer.geometryDefinition))})`;return super._createTileRendererHash(t)+s}async _createServiceOptions(){const t=this.layer,{objectIdField:s}=t,e=t.fields.map((t=>t.toJSON())),i=m(t.geometryType),p=t.timeInfo&&t.timeInfo.toJSON()||null,r=t.spatialReference?t.spatialReference.toJSON():null;return{type:"stream",isPaused:this._isUserPaused,fields:e,geometryType:i,objectIdField:s,timeInfo:p,source:this.layer.parsedUrl,serviceFilter:j(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enabledEventTypes:Array.from(this._enabledEventTypes.values()),spatialReference:r,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval,customParameters:t.customParameters}}};t([s()],d.prototype,"pipelineConnectionStatus",void 0),t([s()],d.prototype,"pipelineErrorString",void 0),t([s({readOnly:!0})],d.prototype,"connectionError",null),t([s({readOnly:!0})],d.prototype,"_streamConnectionStatus",null),d=t([i("esri.views.2d.layers.StreamLayerView2D")],d);const b=d;export default b;
//# sourceMappingURL=p-fca020a3.js.map