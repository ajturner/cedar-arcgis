import{V as t,ad as i,R as s,ac as p,k as r,l as o,n as e}from"./p-98455486.js";import{n as a}from"./p-b15bfa44.js";import{m,c as h,C as n,T as c,j,S as f,O as b}from"./p-ad2e0866.js";import{f as d,d as u}from"./p-f7917469.js";import{i as l}from"./p-71431ad3.js";import{o as g}from"./p-bd7f9fc7.js";import"./p-5572f01a.js";import"./p-07f12c16.js";import"./p-1abe3c64.js";import"./p-13e550f5.js";import"./p-7099a764.js";import"./p-0c70c0e2.js";import"./p-d46be2b1.js";import"./p-fc9cd10b.js";import"./p-4f27d9ab.js";import"./p-ecc7ed03.js";import"./p-c5929b55.js";import"./p-8043ab9b.js";import"./p-4cbc7b66.js";import"./p-3a9bb31c.js";import"./p-f5452a6b.js";import"./p-8b2bb530.js";import"./p-9a4094ba.js";import"./p-9f1a0adc.js";import"./p-a9fef357.js";import"./p-0d2202fd.js";import"./p-f33b44a5.js";import"./p-e91d9d8d.js";import"./p-e22a21a4.js";import"./p-958a5da8.js";import"./p-fcbd27c0.js";import"./p-5abe9c67.js";import"./p-66f65b6a.js";import"./p-14843b2a.js";import"./p-ffb89da5.js";import"./p-dfd7ee02.js";import"./p-da8336be.js";import"./p-1172b129.js";import"./p-e6a64715.js";import"./p-dc29c329.js";import"./p-0fdabe4a.js";import"./p-8399f9e1.js";import"./p-9803a24d.js";import"./p-baa730bb.js";import"./p-e1758a64.js";import"./p-ec443a8b.js";import"./p-f4b056c3.js";import"./p-6133cc0f.js";import"./p-e75aa2b5.js";import"./p-f5f26b1f.js";import"./p-783b6965.js";import"./p-b8afab55.js";import"./p-2d1dac84.js";import"./p-c782b111.js";import"./p-7dc0ec82.js";import"./p-0e94eaa4.js";import"./p-795f7c81.js";import"./p-4a6353a7.js";import"./p-238fbe63.js";import"./p-af5dfb20.js";import"./p-cc77f67d.js";import"./p-ed1a11ab.js";import"./p-908b7a05.js";import"./p-620ed352.js";import"./p-220b11a0.js";import"./p-4f76b2d1.js";import"./p-42c332a2.js";import"./p-38e70926.js";import"./p-69ec1c26.js";import"./p-83c727f2.js";import"./p-2b6b8db8.js";import"./p-50b034e8.js";import"./p-6bb7b693.js";import"./p-de65627f.js";import"./p-a3c11f30.js";import"./p-a18c7841.js";import"./p-1382d09e.js";import"./p-b4b7d6a0.js";import"./p-b0610ac0.js";import"./p-073c3089.js";import"./p-c6ce33a2.js";import"./p-eda79132.js";import"./p-5977fcaf.js";import"./p-eeca6bc1.js";import"./p-21ae9bf7.js";import"./p-aedab47c.js";import"./p-f705ab94.js";import"./p-3c3976eb.js";import"./p-623dbe5e.js";const w=Object.freeze({remove(){},pause(){},resume(){}}),y=["route-info","direction-line","direction-point","polygon-barrier","polyline-barrier","point-barrier","stop"],_={graphic:null,property:null,oldValue:null,newValue:null};function v(t){return t instanceof m||t instanceof h||t instanceof n||t instanceof c||t instanceof j||t instanceof f||t instanceof b}function V(i){return t.isCollection(i)&&i.length&&v(i.at(0))}function k(t){return Array.isArray(t)&&t.length>0&&v(t[0])}let C=class extends(d(u)){constructor(){super(...arguments),this._graphics=new t,this._highlightIds=new Map,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map}get _routeItems(){return new a({getCollections:()=>null==this.layer||this.destroyed?[]:[null!=this.layer.routeInfo?new t([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]})}initialize(){this.updatingHandles.addOnCollectionChange((()=>this._routeItems),(t=>this._routeItemsChanged(t)),i)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get("_routeItems")?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView()}async fetchPopupFeatures(t){return this._graphicsView.hitTest(t).filter((t=>!!t.popupTemplate))}highlight(t){let i;i=v(t)?[this._getNetworkFeatureUid(t)]:k(t)?t.map((t=>this._getNetworkFeatureUid(t))):V(t)?t.map((t=>this._getNetworkFeatureUid(t))).toArray():[t.uid];const p=i.filter(s);return p.length?(this._addHighlight(p),{remove:()=>this._removeHighlight(p)}):w}async hitTest(t,i){if(this.suspended)return null;const p=this._graphicsView.hitTest(t).filter(s).map((t=>this._networkGraphicMap.get(t)));if(!p.length)return null;const{layer:r}=this;return p.reverse().map((i=>({type:"route",layer:r,mapPoint:t,networkFeature:i})))}isUpdating(){return this._graphicsView.updating}moveStart(){}moveEnd(){}update(t){this._graphicsView.processUpdate(t)}viewChange(){this._graphicsView.viewChange()}_addHighlight(t){for(const i of t)if(this._highlightIds.has(i)){const t=this._highlightIds.get(i);this._highlightIds.set(i,t+1)}else this._highlightIds.set(i,1);this._updateHighlight()}_createGraphic(t){const i=t.toGraphic();return i.layer=this.layer,i.sourceLayer=this.layer,i}_createGraphicsView(){const t=this.view,i=()=>this.requestUpdate(),s=new l(t.featuresTilingScheme);this._graphicsView=new g({container:s,graphics:this._graphics,requestUpdateCallback:i,view:t}),this.container.addChild(s),this._updateHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(t){const i=this._networkGraphicMap.get(t);return y.indexOf(i.type)}_getNetworkFeatureUid(t){return this._networkFeatureMap.has(t)?this._networkFeatureMap.get(t).uid:null}_removeHighlight(t){for(const i of t)if(this._highlightIds.has(i)){const t=this._highlightIds.get(i)-1;0===t?this._highlightIds.delete(i):this._highlightIds.set(i,t)}this._updateHighlight()}_routeItemsChanged(t){if(t.removed.length){this._graphics.removeMany(t.removed.map((t=>{const i=this._networkFeatureMap.get(t);return this._networkFeatureMap.delete(t),this._networkGraphicMap.delete(i),i})));for(const i of t.removed)this.removeHandles(i)}if(t.added.length){this._graphics.addMany(t.added.map((t=>{const i=this._createGraphic(t);return null==i.symbol?null:(this._networkFeatureMap.set(t,i),this._networkGraphicMap.set(i,t),i)})).filter(s));for(const i of t.added)this.addHandles([p((()=>i.geometry),((t,s)=>{this._updateGraphic(i,"geometry",t,s)})),p((()=>i.symbol),((t,s)=>{this._updateGraphic(i,"symbol",t,s)}))],i);this._graphics.sort(((t,i)=>this._getDrawOrder(t)-this._getDrawOrder(i)))}}_updateGraphic(t,i,s,p){if(!this._networkFeatureMap.has(t)){const i=this._createGraphic(t);return this._networkFeatureMap.set(t,i),this._networkGraphicMap.set(i,t),void this._graphics.add(i)}const r=this._networkFeatureMap.get(t);r[i]=s,_.graphic=r,_.property=i,_.oldValue=p,_.newValue=s,this._graphicsView.graphicUpdateHandler(_)}_updateHighlight(){const t=Array.from(this._highlightIds.keys());this._graphicsView.setHighlight(t)}};r([o()],C.prototype,"_graphics",void 0),r([o()],C.prototype,"_routeItems",null),C=r([e("esri.views.2d.layers.RouteLayerView2D")],C);const G=C;export default G;
//# sourceMappingURL=p-0611a037.js.map