import{cp as t,e3 as s,dW as i,dZ as n}from"./p-98455486.js";import{f as h}from"./p-9a4094ba.js";class o{constructor(t=9,s){this._compareMinX=a,this._compareMinY=u,this._toBBox=t=>t,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),s&&("function"==typeof s?this._toBBox=s:this._initFormat(s)),this.clear()}destroy(){this.clear(),m.prune(),x.prune(),b.prune(),S.prune()}all(t){this._all(this._data,t)}search(t,s){let i=this._data;const n=this._toBBox;if(w(t,i))for(m.clear();i;){for(let h=0,o=i.children.length;h<o;h++){const o=i.children[h],r=i.leaf?n(o):o;w(t,r)&&(i.leaf?s(o):p(t,r)?this._all(o,s):m.push(o))}i=m.pop()}}collides(t){let s=this._data;const i=this._toBBox;if(!w(t,s))return!1;for(m.clear();s;){for(let n=0,h=s.children.length;n<h;n++){const h=s.children[n],o=s.leaf?i(h):h;if(w(t,o)){if(s.leaf||p(t,o))return!0;m.push(h)}}s=m.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let s=0,i=t.length;s<i;s++)this.insert(t[s]);return this}let s=this._build(t.slice(0,t.length),0,t.length-1,0);if(this._data.children.length)if(this._data.height===s.height)this._splitRoot(this._data,s);else{if(this._data.height<s.height){const t=this._data;this._data=s,s=t}this._insert(s,this._data.height-s.height-1,!0)}else this._data=s;return this}insert(t){return t&&this._insert(t,this._data.height-1),this}clear(){return this._data=new j([]),this}remove(t){if(!t)return this;let n,h=this._data,o=null,r=0,e=!1;const c=this._toBBox(t);for(b.clear(),S.clear();h||b.length>0;){if(h||(h=s(b.pop()),o=b.data[b.length-1],r=S.pop()??0,e=!0),h.leaf&&(n=i(h.children,t,h.children.length,h.indexHint),-1!==n))return h.children.splice(n,1),b.push(h),this._condense(b),this;e||h.leaf||!p(h,c)?o?(r++,h=o.children[r],e=!1):h=null:(b.push(h),S.push(r),r=0,o=h,h=h.children[0])}return this}toJSON(){return this._data}fromJSON(t){return this._data=t,this}_all(t,s){let i=t;for(x.clear();i;){if(!0===i.leaf)for(const t of i.children)s(t);else x.pushArray(i.children);i=x.pop()??null}}_build(t,s,i,n){const h=i-s+1;let o=this._maxEntries;if(h<=o){const n=new j(t.slice(s,i+1));return r(n,this._toBBox),n}n||(n=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/o**(n-1)));const e=new B([]);e.height=n;const c=Math.ceil(h/o),a=c*Math.ceil(Math.sqrt(o));_(t,s,i,a,this._compareMinX);for(let h=s;h<=i;h+=a){const s=Math.min(h+a-1,i);_(t,h,s,c,this._compareMinY);for(let i=h;i<=s;i+=c){const h=Math.min(i+c-1,s);e.children.push(this._build(t,i,h,n-1))}}return r(e,this._toBBox),e}_chooseSubtree(t,s,i,n){for(;n.push(s),!0!==s.leaf&&n.length-1!==i;){let i,n=1/0,h=1/0;for(let o=0,r=s.children.length;o<r;o++){const r=s.children[o],e=l(r),c=M(t,r)-e;c<h?(h=c,n=e<n?e:n,i=r):c===h&&e<n&&(n=e,i=r)}s=i||s.children[0]}return s}_insert(t,s,i){const n=this._toBBox,h=i?t:n(t);b.clear();const o=this._chooseSubtree(h,this._data,s,b);for(o.children.push(t),c(o,h);s>=0&&b.data[s].children.length>this._maxEntries;)this._split(b,s),s--;this._adjustParentBBoxes(h,b,s)}_split(t,s){const i=t.data[s],n=i.children.length,h=this._minEntries;this._chooseSplitAxis(i,h,n);const o=this._chooseSplitIndex(i,h,n);if(!o)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const e=i.children.splice(o,i.children.length-o),c=i.leaf?new j(e):new B(e);c.height=i.height,r(i,this._toBBox),r(c,this._toBBox),s?t.data[s-1].children.push(c):this._splitRoot(i,c)}_splitRoot(t,s){this._data=new B([t,s]),this._data.height=t.height+1,r(this._data,this._toBBox)}_chooseSplitIndex(t,s,i){let n,h,o;n=h=1/0;for(let r=s;r<=i-s;r++){const s=e(t,0,r,this._toBBox),c=e(t,r,i,this._toBBox),a=d(s,c),u=l(s)+l(c);a<n?(n=a,o=r,h=u<h?u:h):a===n&&u<h&&(h=u,o=r)}return o}_chooseSplitAxis(t,s,i){const n=t.leaf?this._compareMinX:a,h=t.leaf?this._compareMinY:u;this._allDistMargin(t,s,i,n)<this._allDistMargin(t,s,i,h)&&t.children.sort(n)}_allDistMargin(t,s,i,n){t.children.sort(n);const h=this._toBBox,o=e(t,0,s,h),r=e(t,i-s,i,h);let a=f(o)+f(r);for(let n=s;n<i-s;n++){const s=t.children[n];c(o,t.leaf?h(s):s),a+=f(o)}for(let n=i-s-1;n>=s;n--){const s=t.children[n];c(r,t.leaf?h(s):s),a+=f(r)}return a}_adjustParentBBoxes(t,s,i){for(let n=i;n>=0;n--)c(s.data[n],t)}_condense(t){for(let s=t.length-1;s>=0;s--){const n=t.data[s];if(0===n.children.length)if(s>0){const h=t.data[s-1],o=h.children;o.splice(i(o,n,o.length,h.indexHint),1)}else this.clear();else r(n,this._toBBox)}}_initFormat(t){const s=["return a"," - b",";"];this._compareMinX=new Function("a","b",s.join(t[0])),this._compareMinY=new Function("a","b",s.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function r(t,s){e(t,0,t.children.length,s,t)}function e(t,s,i,n,h){h||(h=new j([])),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let o,r=s;r<i;r++)o=t.children[r],c(h,t.leaf?n(o):o);return h}function c(t,s){t.minX=Math.min(t.minX,s.minX),t.minY=Math.min(t.minY,s.minY),t.maxX=Math.max(t.maxX,s.maxX),t.maxY=Math.max(t.maxY,s.maxY)}function a(t,s){return t.minX-s.minX}function u(t,s){return t.minY-s.minY}function l(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function M(t,s){return(Math.max(s.maxX,t.maxX)-Math.min(s.minX,t.minX))*(Math.max(s.maxY,t.maxY)-Math.min(s.minY,t.minY))}function d(t,s){const i=Math.max(t.minX,s.minX),n=Math.max(t.minY,s.minY),h=Math.min(t.maxX,s.maxX),o=Math.min(t.maxY,s.maxY);return Math.max(0,h-i)*Math.max(0,o-n)}function p(t,s){return t.minX<=s.minX&&t.minY<=s.minY&&s.maxX<=t.maxX&&s.maxY<=t.maxY}function w(t,s){return s.minX<=t.maxX&&s.minY<=t.maxY&&s.maxX>=t.minX&&s.maxY>=t.minY}function _(t,i,n,o,r){const e=[i,n];for(;e.length;){const i=s(e.pop()),n=s(e.pop());if(i-n<=o)continue;const c=n+Math.ceil((i-n)/o/2)*o;h(t,c,n,i,r),e.push(n,c,c,i)}}const m=new t,x=new t,b=new t,S=new t({deallocator:void 0});class v{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class F extends v{constructor(){super(...arguments),this.height=1,this.indexHint=new n}}class j extends F{constructor(t){super(),this.children=t,this.leaf=!0}}class B extends F{constructor(t){super(),this.children=t,this.leaf=!1}}export{o as h};
//# sourceMappingURL=p-fe526e38.js.map